<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pokemon Card Collection Game</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(45deg, #2c5530, #3e7b3e);
      color: white;
      overflow: hidden;
    }
    
    .game-container {
      display: flex;
      height: 100vh;
    }
    
    .map-section {
      flex: 3;
      position: relative;
      background: #1a4d1a;
      border-right: 3px solid #8B4513;
    }
    
    .ui-section {
      flex: 1;
      background: #2c2c2c;
      padding: 20px;
      overflow-y: auto;
    }
    
    .map-container {
      width: 100%;
      height: 100%;
      overflow: auto;
      position: relative;
    }
    
    .map-grid {
      display: grid;
      grid-template-columns: repeat(50, 16px);
      grid-template-rows: repeat(50, 16px);
      gap: 0;
      padding: 20px;
      background: #2d5a2d;
    }
    
    .tile {
      width: 16px;
      height: 16px;
      position: relative;
    }
    
    .grass { background: #4CAF50; }
    .water { background: #2196F3; }
    .path { background: #8D6E63; }
    .tree { background: #1B5E20; }
    
    .player {
      background: #FF5722 !important;
      border: 1px solid #BF360C;
      border-radius: 50%;
      z-index: 100;
    }
    
    .trainer {
      background: #9C27B0 !important;
      border: 1px solid #4A148C;
      border-radius: 50%;
      z-index: 99;
    }
    
    .ui-panel {
      background: #333;
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #555;
    }
    
    .button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      font-weight: bold;
      transition: all 0.2s;
    }
    
    .button:hover {
      background: #45a049;
      transform: translateY(-1px);
    }
    
    .button.danger {
      background: #f44336;
    }
    
    .button.danger:hover {
      background: #da190b;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: #2c2c2c;
      padding: 30px;
      border-radius: 15px;
      border: 3px solid #555;
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      color: white;
    }
    
    /* Shop Styles */
    .shop-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid #555;
    }
    
    .shop-tab {
      background: #444;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      margin-right: 5px;
      transition: background 0.3s;
    }
    
    .shop-tab:hover {
      background: #555;
    }
    
    .shop-tab.active {
      background: #007bff;
    }
    
    .shop-section {
      margin-top: 20px;
    }
    
    .badge-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .badge-card {
      background: linear-gradient(135deg, #ffd700, #ffb300);
      border: 3px solid #ff8f00;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      color: #333;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      transition: all 0.3s;
    }
    
    .badge-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.4);
    }
    
    .badge-card.owned {
      background: linear-gradient(135deg, #4caf50, #45a049);
      border-color: #2e7d32;
      color: white;
    }
    
    .badge-image {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 0 auto 15px;
      background-size: cover;
      background-position: center;
      border: 3px solid rgba(255,255,255,0.3);
    }
    
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .pokemon-card {
      background: linear-gradient(135deg, #4a90a4, #357a8a);
      border: 3px solid #2c5aa0;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    
    .pokemon-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, #ffd700, #ffa500, #ffd700, #ffa500);
      border-radius: 15px;
      z-index: -1;
      animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.7; }
    }
    
    .pokemon-card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 12px 24px rgba(0,0,0,0.4);
    }
    
    .card-header {
      text-align: center;
      margin-bottom: 15px;
    }
    
    .pokemon-name {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
    
    .pokemon-types {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .type-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .type-fire { background: #ff6666; }
    .type-water { background: #6666ff; }
    .type-grass { background: #66ff66; }
    .type-electric { background: #ffff66; color: #333; }
    .type-psychic { background: #ff66ff; }
    .type-ice { background: #66ffff; color: #333; }
    .type-dragon { background: #9966ff; }
    .type-dark { background: #666666; }
    .type-fighting { background: #cc6666; }
    .type-poison { background: #cc66cc; }
    .type-ground { background: #cccc66; color: #333; }
    .type-flying { background: #9999ff; }
    .type-bug { background: #99cc66; }
    .type-rock { background: #cccc99; color: #333; }
    .type-ghost { background: #9999cc; }
    .type-steel { background: #b3b3cc; }
    .type-fairy { background: #ffb3e6; }
    .type-normal { background: #cccccc; color: #333; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .stat {
      background: rgba(255,255,255,0.1);
      padding: 8px;
      border-radius: 5px;
      text-align: center;
    }
    
    .stat-label {
      font-size: 11px;
      opacity: 0.8;
      text-transform: uppercase;
    }
    
    .stat-value {
      font-size: 16px;
      font-weight: bold;
    }
    
    .moves-section {
      margin-top: 15px;
    }
    
    .moves-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px;
    }
    
    .move {
      background: rgba(255,255,255,0.1);
      padding: 6px 8px;
      border-radius: 4px;
      font-size: 11px;
      text-align: center;
    }
    
    /* Team Display Styles */
    .team-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    
    .team-pokemon {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #444;
      border: 2px solid #666;
      border-radius: 10px;
      padding: 8px;
      transition: all 0.2s;
    }
    
    .team-pokemon:hover {
      border-color: #888;
      transform: translateY(-2px);
    }
    
    .team-pokemon-image {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      margin-bottom: 5px;
      background-size: cover;
      background-position: center;
      background-color: #666;
      border: 1px solid #888;
    }
    
    .team-pokemon-name {
      font-size: 10px;
      font-weight: bold;
      margin-bottom: 3px;
      text-align: center;
      color: white;
    }
    
    .hp-bar-container {
      width: 100%;
      background: #333;
      border-radius: 4px;
      height: 8px;
      margin-bottom: 4px;
      border: 1px solid #555;
      position: relative;
      overflow: hidden;
    }
    
    .hp-bar {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s ease;
      position: absolute;
      top: 0;
      left: 0;
    }
    
    .hp-bar.high {
      background: linear-gradient(90deg, #4caf50, #81c784);
    }
    
    .hp-bar.medium {
      background: linear-gradient(90deg, #ff9800, #ffb74d);
    }
    
    .hp-bar.low {
      background: linear-gradient(90deg, #f44336, #ef5350);
    }
    
    .hp-text {
      font-size: 8px;
      color: #ccc;
      text-align: center;
      margin-top: 1px;
    }
    
    /* Card Binder Styles */
    .card-binder-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 20px;
      padding: 20px;
      background: #222;
      border-radius: 10px;
    }
    
    .trading-card {
      background: #333;
      border: 3px solid #555;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      transition: all 0.3s;
      aspect-ratio: 2.5/3.5;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .trading-card.collected {
      border-color: #ffd700;
      background: linear-gradient(135deg, #444, #555);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    }
    
    .trading-card.locked {
      opacity: 0.3;
      filter: grayscale(100%);
    }
    
    .trading-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    
    .card-image {
      width: 100%;
      height: 70%;
      border-radius: 8px;
      background-size: cover;
      background-position: center;
      border: 2px solid #666;
    }
    
    .card-info {
      margin-top: 8px;
    }
    
    .card-name {
      font-size: 12px;
      font-weight: bold;
      color: white;
      margin-bottom: 3px;
    }
    
    .card-status {
      font-size: 10px;
      color: #ccc;
    }
    
    .bag-section {
      margin-top: 20px;
    }
    
    .battle-selection {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 20px 0;
    }
    
    .battle-pokemon-card {
      background: #444;
      border: 2px solid #666;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .battle-pokemon-card:hover {
      border-color: #4CAF50;
      background: #4a4a4a;
    }
    
    .battle-pokemon-card.selected {
      border-color: #FFD700;
      background: #5a5a2a;
    }
    
    .battle-pokemon-card.fainted {
      opacity: 0.5;
      background: #666;
      cursor: not-allowed;
    }
    
    .battle-log {
      background: #1a1a1a;
      border: 2px solid #444;
      border-radius: 8px;
      padding: 15px;
      height: 200px;
      overflow-y: auto;
      margin: 15px 0;
      font-family: monospace;
      font-size: 13px;
    }
    
    .hp-bar {
      width: 100%;
      height: 8px;
      background: #333;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 5px;
    }
    
    .hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff4444, #ffaa00, #44ff44);
      transition: width 0.3s ease;
    }
    
    .battle-info {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      text-align: center;
    }
    
    .battle-pokemon {
      flex: 1;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      margin: 0 10px;
      border-radius: 10px;
    }
    
    .controls-info {
      background: #444;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 12px;
    }
    
    .move-selection {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin: 15px 0;
    }
    
    .move-button {
      background: #4a4a4a;
      border: 2px solid #666;
      border-radius: 8px;
      padding: 12px;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    
    .move-button:hover {
      border-color: #4CAF50;
      background: #555;
    }
    
    .move-button.selected {
      border-color: #FFD700;
      background: #5a5a2a;
    }
    
    .move-name {
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    .move-details {
      font-size: 11px;
      opacity: 0.8;
    }
    
    .effectiveness {
      font-weight: bold;
      color: #ff6666;
    }
    
    .effectiveness.super-effective {
      color: #66ff66;
    }
    
    .effectiveness.not-very-effective {
      color: #ffaa00;
    }
    
    .effectiveness.no-effect {
      color: #888;
    }
    
    .battle-pokemon-info {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      text-align: center;
    }
    
    .current-battle-pokemon {
      flex: 1;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      margin: 0 10px;
      border-radius: 10px;
    }
    
    /* Audio Controls */
    .audio-controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #555;
      z-index: 1000;
    }
    
    .audio-button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin: 2px;
      font-size: 12px;
      transition: background 0.3s;
    }
    
    .audio-button:hover {
      background: #45a049;
    }
    
    .audio-button.paused {
      background: #f44336;
    }
    
    .volume-control {
      display: flex;
      align-items: center;
      margin-top: 5px;
    }
    
    .volume-slider {
      width: 80px;
      margin-left: 5px;
    }
    
    #youtube-player {
      display: none;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="map-section">
      <div class="map-container">
        <div class="map-grid" id="map-grid"></div>
      </div>
    </div>
    
    <div class="ui-section">
      <div class="ui-panel">
        <h2>Pokemon Collection</h2>
        <div>Collected: <span id="collection-count">0</span>/92</div>
        <div>Money: $<span id="money">0</span></div>
        <div>Position: (<span id="player-x">25</span>, <span id="player-y">25</span>)</div>
        <div>Steps: <span id="step-count">0</span></div>
        <button class="button" onclick="openBag()">View Bag</button>
        <button class="button" onclick="openShop()">Shop</button>
      </div>
      
      <div class="ui-panel">
        <h3>Current Team</h3>
        <div id="team-display">No Pokemon in team</div>
        <div style="margin-top: 10px;">
          <button class="button" onclick="autoSelectTeam()" id="auto-team-btn" style="display:none;">Auto-Select Team</button>
        </div>
      </div>
      
      <div class="ui-panel">
        <h3>Game Log</h3>
        <div id="game-status">Walk on grass to find Pokemon!</div>
      </div>
      
      <div class="controls-info">
        <strong>Controls:</strong><br>
        WASD/Arrow Keys: Move<br>
        Enter: Interact with trainers<br>
        Walk on grass (green) for Pokemon!
      </div>
    </div>
  </div>

  <!-- Bag Modal -->
  <div class="modal" id="bag-modal">
    <div class="modal-content">
      <h2>Collection</h2>
      <button class="button danger" onclick="closeBag()" style="float: right;">Close</button>
      
      <!-- Bag Tabs -->
      <div class="shop-tabs">
        <button class="shop-tab active" onclick="showBagTab('pokemon')">Pokemon</button>
        <button class="shop-tab" onclick="showBagTab('cards')">Card Binder</button>
      </div>
      
      <!-- Pokemon Collection -->
      <div id="pokemon-collection" class="bag-section">
        <div class="card-grid" id="pokemon-cards"></div>
      </div>
      
      <!-- Card Binder -->
      <div id="card-binder" class="bag-section" style="display: none;">
        <div class="card-binder-grid" id="trading-cards-display">
        </div>
        <div id="card-victory-message" style="display: none; text-align: center; margin-top: 20px;">
          <h1 style="color: gold;">ðŸŽ‰ YOU BEAT THE GAME! ðŸŽ‰</h1>
          <p>Congratulations! You've collected all 8 trading cards!</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Shop Modal -->
  <div class="modal" id="shop-modal">
    <div class="modal-content">
      <h2>Pokemon Shop</h2>
      <button class="button danger" onclick="closeShop()" style="float: right;">Close</button>
      <div style="margin-bottom: 20px;">
        <strong>Money: $<span id="money-display">500</span></strong>
      </div>
      
      <!-- Shop Tabs -->
      <div class="shop-tabs">
        <button class="shop-tab active" onclick="showShopTab('pokemon')">Pokemon ($100)</button>
      </div>
      
      <!-- Pokemon Shop -->
      <div id="pokemon-shop" class="shop-section">
        <div style="max-height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: #f0f0f0;">
                <th style="padding: 8px; border: 1px solid #ccc;">Pokemon</th>
                <th style="padding: 8px; border: 1px solid #ccc;">Type(s)</th>
                <th style="padding: 8px; border: 1px solid #ccc;">Action</th>
              </tr>
            </thead>
            <tbody id="pokemon-shop-list">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Battle Modal -->
  <div class="modal" id="battle-modal">
    <div class="modal-content">
      <h2>Trainer Battle</h2>
      <div id="battle-content"></div>
    </div>
  </div>

  <script>
            const pokemonStats = {
            "Florges": [360, 229, 235, 323, 407, 249],
            "Togekiss": [374, 199, 289, 339, 329, 259],
            "Gyarados": [394, 349, 257, 219, 299, 261],
            "Milotic": [394, 219, 257, 299, 349, 261],
            "Noivern": [374, 239, 259, 293, 259, 345],
            "Charizard": [360, 267, 255, 317, 269, 299],
            "Empoleon": [372, 271, 275, 321, 301, 219],
            "Mamoswine": [424, 359, 259, 239, 219, 259],
            "Greninja": [348, 289, 233, 305, 241, 343],
            "Incineroar": [394, 329, 279, 259, 279, 219],
            "Golisopod": [354, 349, 379, 219, 279, 179],
            "Jolteon": [334, 229, 219, 319, 289, 359],
            "Torterra": [394, 317, 309, 249, 269, 211],
            "Infernape": [356, 307, 241, 307, 241, 315],
            "Lucario": [344, 319, 239, 329, 239, 279],
            "Tyrantrum": [368, 341, 337, 237, 217, 241],
            "Chandelure": [324, 209, 279, 389, 279, 259],
            "Krookodile": [394, 333, 259, 229, 239, 283],
            "Roserade": [324, 239, 229, 349, 309, 279],
            "Cryogonal": [364, 199, 199, 289, 369, 309],
            "Gliscor": [354, 289, 349, 189, 249, 289],
            "Braviary": [404, 345, 249, 213, 249, 259],
            "Mienshao": [334, 349, 219, 289, 219, 309],
            "Tsareena": [348, 339, 295, 199, 295, 243],
            "Excadrill": [424, 369, 219, 199, 229, 275],
            "Rapidash": [334, 299, 239, 259, 259, 309],
            "Gengar": [324, 229, 219, 359, 249, 319],
            "Drapion": [344, 279, 319, 219, 249, 289],
            "Clawitzer": [346, 245, 275, 339, 277, 217],
            "Vikavolt": [358, 239, 279, 389, 249, 185],
            "Mudsdale": [404, 349, 299, 209, 269, 169],
            "Talonflame": [360, 261, 241, 247, 237, 351],
            "Escavalier": [344, 369, 309, 219, 309, 139],
            "Mismagius": [324, 219, 219, 309, 309, 309],
            "Dragalge": [334, 249, 279, 293, 345, 187],
            "Dragapult": [380, 339, 249, 299, 249, 383],
            "Staraptor": [374, 339, 239, 199, 219, 299],
            "Lopunny": [334, 251, 267, 207, 291, 309],
            "Whimsicott": [324, 233, 269, 253, 249, 331],
            "Lilligant": [344, 219, 249, 319, 249, 279],
            "Leavanny": [354, 305, 259, 239, 259, 283],
            "Hariyama": [492, 339, 219, 179, 219, 199],
            "Cinccino": [354, 289, 219, 229, 219, 329],
            "Slowking": [394, 249, 259, 299, 319, 159],
            "Skarmory": [334, 259, 379, 179, 239, 239],
            "Stoutland": [374, 319, 279, 189, 279, 259],
            "Houndoom": [354, 279, 199, 319, 259, 289],
            "Beartic": [394, 359, 259, 239, 259, 199],
            "Zoroark": [324, 309, 219, 339, 219, 309],
            "Ampharos": [384, 249, 269, 329, 279, 209],
            "Dhelmise": [344, 361, 299, 271, 279, 179],
            "Leafeon": [334, 319, 359, 219, 229, 289],
            "Primarina": [364, 247, 247, 351, 331, 219],
            "Decidueye": [360, 313, 249, 299, 299, 239],
            "Swampert": [404, 319, 279, 269, 279, 219],
            "Kingdra": [354, 289, 289, 289, 289, 269],
            "Pheromosa": [346, 373, 173, 373, 173, 401],
            "Sceptile": [344, 269, 229, 309, 269, 339],
            "Blaziken": [364, 339, 239, 319, 239, 259],
            "Scizor": [344, 359, 299, 209, 259, 229],
            "Samurott": [394, 299, 269, 315, 239, 239],
            "Gardevoir": [340, 229, 229, 349, 329, 259],
            "Gallade": [340, 349, 229, 229, 329, 259],
            "Aurorus": [450, 253, 243, 297, 283, 215],
            "Suicune": [404, 249, 329, 279, 329, 269],
            "Tapu Koko": [344, 329, 269, 289, 249, 359],
            "Great Tusk": [434, 361, 361, 205, 205, 273],
            "Fezandipiti": [380, 281, 263, 239, 349, 297],
            "Magnezone": [344, 239, 329, 359, 279, 219],
            "Durant": [320, 317, 323, 195, 195, 317],
            "Duraludon": [344, 289, 329, 339, 199, 269],
            "Typhlosion": [360, 267, 255, 317, 269, 299],
            "Meowscarada": [356, 319, 239, 261, 239, 345],
            "Quaquaval": [374, 339, 259, 269, 249, 269],
            "Cinderace": [364, 331, 249, 229, 249, 337],
            "Centiskorch": [404, 329, 229, 279, 279, 229],
            "Armarouge": [374, 219, 299, 349, 259, 249],
            "Ceruledge": [354, 349, 259, 219, 299, 269],
            "Hatterene": [318, 279, 289, 371, 305, 157],
            "Arboliva": [360, 237, 279, 349, 317, 177],
            "Tinkaton": [374, 249, 253, 239, 309, 287],
            "Copperajah": [448, 359, 237, 259, 237, 159],
            "Revavroom": [364, 337, 279, 207, 233, 279],
            "Toxicroak": [370, 311, 229, 271, 229, 269],
            "Kilowattrel": [344, 239, 219, 309, 219, 349],
            "Grafaiai": [330, 289, 229, 259, 243, 319],
            "Salamence": [394, 369, 259, 319, 259, 299],
            "Nihilego": [422, 205, 193, 353, 361, 305],
            "Hydrapple": [416, 259, 319, 339, 259, 187],
            "Rillaboom": [404, 349, 279, 219, 239, 269],
            "Inteleon": [344, 269, 229, 349, 229, 339],
            "Iron Valiant": [352, 359, 279, 339, 219, 331],
        };

        const moves = {
            "Petal Dance": { type: "Grass", basePower: 120, accuracy: 100 },
            "Moonblast": { type: "Fairy", basePower: 95, accuracy: 100 },
            "Pollen Puff": { type: "Bug", basePower: 90, accuracy: 100 },
            "Chilling Water": { type: "Water", basePower: 50, accuracy: 100 },
            "Air Slash": { type: "Flying", basePower: 75, accuracy: 95 },
            "Dazzling Gleam": { type: "Fairy", basePower: 80, accuracy: 100 },
            "Aura Sphere": { type: "Fighting", basePower: 80, accuracy: 100 },
            "Ancient Power": { type: "Rock", basePower: 60, accuracy: 100 },
            "Aqua Tail": { type: "Water", basePower: 90, accuracy: 90 },
            "Thrash": { type: "Normal", basePower: 120, accuracy: 100 },
            "Crunch": { type: "Dark", basePower: 80, accuracy: 100 },
            "Ice Fang": { type: "Ice", basePower: 65, accuracy: 95 },
            "Hydro Pump": { type: "Water", basePower: 110, accuracy: 80 },
            "Ice Beam": { type: "Ice", basePower: 90, accuracy: 100 },
            "Dragon Pulse": { type: "Dragon", basePower: 85, accuracy: 100 },
            "Disarming Voice": { type: "Fairy", basePower: 40, accuracy: 100 },
            "Hurricane": { type: "Flying", basePower: 110, accuracy: 70 },
            "Boomburst": { type: "Normal", basePower: 140, accuracy: 100 },
            "Flamethrower": { type: "Fire", basePower: 90, accuracy: 100 },
            "Flash Cannon": { type: "Steel", basePower: 80, accuracy: 100 },
            "Drill Peck": { type: "Flying", basePower: 80, accuracy: 100 },
            "Earthquake": { type: "Ground", basePower: 100, accuracy: 100 },
            "Rock Slide": { type: "Rock", basePower: 75, accuracy: 90 },
            "Extrasensory": { type: "Psychic", basePower: 80, accuracy: 100 },
            "Dark Pulse": { type: "Dark", basePower: 80, accuracy: 100 },
            "Flare Blitz": { type: "Fire", basePower: 120, accuracy: 100 },
            "Cross Chop": { type: "Fighting", basePower: 100, accuracy: 80 },
            "Darkest Lariat": { type: "Dark", basePower: 85, accuracy: 100 },
            "First Impression": { type: "Bug", basePower: 90, accuracy: 100 },
            "Liquidation": { type: "Water", basePower: 85, accuracy: 100 },
            "Sucker Punch": { type: "Dark", basePower: 70, accuracy: 100 },
            "Brick Break": { type: "Fighting", basePower: 75, accuracy: 100 },
            "Thunder": { type: "Electric", basePower: 110, accuracy: 70 },
            "Hyper Voice": { type: "Normal", basePower: 90, accuracy: 100 },
            "Shadow Ball": { type: "Ghost", basePower: 80, accuracy: 100 },
            "Alluring Voice": { type: "Fairy", basePower: 80, accuracy: 100 },
            "Headlong Rush": { type: "Ground", basePower: 120, accuracy: 100 },
            "Wood Hammer": { type: "Grass", basePower: 120, accuracy: 100 },
            "Zen Headbutt": { type: "Psychic", basePower: 80, accuracy: 90 },
            "Close Combat": { type: "Fighting", basePower: 120, accuracy: 100 },
            "Thunder Punch": { type: "Electric", basePower: 75, accuracy: 100 },
            "U-turn": { type: "Bug", basePower: 70, accuracy: 100 },
            "Meteor Mash": { type: "Steel", basePower: 90, accuracy: 90 },
            "Extreme Speed": { type: "Normal", basePower: 80, accuracy: 100 },
            "Head Smash": { type: "Rock", basePower: 150, accuracy: 80 },
            "Giga Impact": { type: "Normal", basePower: 150, accuracy: 90 },
            "Dragon Claw": { type: "Dragon", basePower: 80, accuracy: 100 },
            "Overheat": { type: "Fire", basePower: 130, accuracy: 90 },
            "Energy Ball": { type: "Grass", basePower: 90, accuracy: 100 },
            "Foul Play": { type: "Dark", basePower: 95, accuracy: 100 },
            "Outrage": { type: "Dragon", basePower: 120, accuracy: 100 },
            "Sludge Bomb": { type: "Poison", basePower: 90, accuracy: 100 },
            "Solar Beam": { type: "Grass", basePower: 120, accuracy: 100 },
            "Crabhammer": { type: "Water", basePower: 100, accuracy: 90 },
            "Poison Jab": { type: "Poison", basePower: 80, accuracy: 100 },
            "Sky Attack": { type: "Flying", basePower: 140, accuracy: 90 },
            "Superpower": { type: "Fighting", basePower: 120, accuracy: 100 },
            "Wing Attack": { type: "Flying", basePower: 60, accuracy: 100 },
            "High Jump Kick": { type: "Fighting", basePower: 130, accuracy: 90 },
            "Bounce": { type: "Flying", basePower: 85, accuracy: 85 },
            "Power Whip": { type: "Grass", basePower: 120, accuracy: 85 },
            "X-Scissor": { type: "Bug", basePower: 80, accuracy: 100 },
            "Megahorn": { type: "Bug", basePower: 120, accuracy: 85 },
            "High Horsepower": { type: "Ground", basePower: 95, accuracy: 95 },
            "Icy Wind": { type: "Ice", basePower: 55, accuracy: 95 },
            "Dream Eater": { type: "Psychic", basePower: 100, accuracy: 100 },
            "Cross Poison": { type: "Poison", basePower: 70, accuracy: 100 },
            "Fire Fang": { type: "Fire", basePower: 65, accuracy: 95 },
            "Muddy Water": { type: "Water", basePower: 90, accuracy: 85 },
            "Zap Cannon": { type: "Electric", basePower: 120, accuracy: 50 },
            "Fly": { type: "Flying", basePower: 90, accuracy: 95 },
            "Bug Buzz": { type: "Bug", basePower: 90, accuracy: 100 },
            "Double-Edge": { type: "Normal", basePower: 120, accuracy: 100 },
            "Iron Head": { type: "Steel", basePower: 80, accuracy: 100 },
            "Steel Wing": { type: "Steel", basePower: 70, accuracy: 90 },
            "Quick Attack": { type: "Normal", basePower: 40, accuracy: 100 },
            "Drill Run": { type: "Ground", basePower: 80, accuracy: 95 },
            "Mystical Fire": { type: "Fire", basePower: 75, accuracy: 95 },
            "Magical Leaf": { type: "Grass", basePower: 60, accuracy: 100 },
            "Power Gem": { type: "Rock", basePower: 80, accuracy: 100 },
            "Last Resort": { type: "Normal", basePower: 140, accuracy: 100 },
            "Dragon Rush": { type: "Dragon", basePower: 100, accuracy: 75 },
            "Phantom Force": { type: "Ghost", basePower: 90, accuracy: 100 },
            "Astonish": { type: "Ghost", basePower: 30, accuracy: 100 },
            "Strength": { type: "Normal", basePower: 80, accuracy: 100 },
            "Ice Punch": { type: "Ice", basePower: 75, accuracy: 100 },
            "Fire Punch": { type: "Fire", basePower: 75, accuracy: 100 },
            "Fairy Wind": { type: "Fairy", basePower: 40, accuracy: 100 },
            "Tera Blast": { type: "Normal", basePower: 80, accuracy: 100 },
            "Leaf Storm": { type: "Grass", basePower: 130, accuracy: 90 },
            "Leaf Blade": { type: "Grass", basePower: 90, accuracy: 100 },
            "Throat Chop": { type: "Dark", basePower: 80, accuracy: 100 },
            "Focus Punch": { type: "Fighting", basePower: 150, accuracy: 100 },
            "Knock Off": { type: "Dark", basePower: 65, accuracy: 100 },
            "Bullet Punch": { type: "Steel", basePower: 40, accuracy: 100 },
            "Ice Spinner": { type: "Ice", basePower: 80, accuracy: 100 },
            "Future Sight": { type: "Psychic", basePower: 120, accuracy: 100 },
            "Belch": { type: "Poison", basePower: 120, accuracy: 100 },
            "Scald": { type: "Water", basePower: 80, accuracy: 100 },
            "Night Slash": { type: "Dark", basePower: 70, accuracy: 100 },
            "Play Rough": { type: "Fairy", basePower: 90, accuracy: 90 },
            "Thunder Fang": { type: "Electric", basePower: 65, accuracy: 95 },
            "Icicle Crash": { type: "Ice", basePower: 85, accuracy: 90 },
            "Focus Blast": { type: "Fighting", basePower: 120, accuracy: 70 },
            "Poltergeist": { type: "Ghost", basePower: 110, accuracy: 100 },
            "Anchor Shot": { type: "Steel", basePower: 80, accuracy: 100 },
            "Whirlpool": { type: "Water", basePower: 35, accuracy: 85 },
            "Dig": { type: "Ground", basePower: 80, accuracy: 100 },
            "Triple Arrows": { type: "Fighting", basePower: 90, accuracy: 90 },
            "Hammer Arm": { type: "Fighting", basePower: 100, accuracy: 90 },
            "Triple Axel": { type: "Ice", basePower: 20, accuracy: 90, multiHit: true },
            "Sacred Sword": { type: "Fighting", basePower: 90, accuracy: 100 },
            "Charge Beam": { type: "Electric", basePower: 50, accuracy: 90 },
            "Psycho Cut": { type: "Psychic", basePower: 70, accuracy: 100 },
            "Hyper Beam": { type: "Normal", basePower: 150, accuracy: 90 },
            "Blizzard": { type: "Ice", basePower: 110, accuracy: 70 },
            "Meteor Beam": { type: "Rock", basePower: 120, accuracy: 90 },
            "Wild Charge": { type: "Electric", basePower: 90, accuracy: 100 },
            "Eruption": { type: "Fire", basePower: 150, accuracy: 100 },
            "Scorching Sands": { type: "Ground", basePower: 70, accuracy: 100 },
            "Petal Blizzard": { type: "Grass", basePower: 90, accuracy: 100 },
            "Wave Crash": { type: "Water", basePower: 120, accuracy: 100 },
            "Pyro Ball": { type: "Fire", basePower: 120, accuracy: 90 },
            "Lunge": { type: "Bug", basePower: 80, accuracy: 100 },
            "Burn Up": { type: "Fire", basePower: 130, accuracy: 100 },
            "Armor Cannon": { type: "Fire", basePower: 120, accuracy: 100 },
            "Psychic": { type: "Psychic", basePower: 90, accuracy: 100 },
            "Gigaton Hammer": { type: "Steel", basePower: 160, accuracy: 100 },
            "Ice Hammer": { type: "Ice", basePower: 100, accuracy: 90 },
            "Skitter Smack": { type: "Bug", basePower: 70, accuracy: 100 },
            "Gunk Shot": { type: "Poison", basePower: 120, accuracy: 80 },
            "Spin Out": { type: "Steel", basePower: 100, accuracy: 100 },
            "Uproar": { type: "Normal", basePower: 90, accuracy: 100 },
            "Sludge Wave": { type: "Poison", basePower: 95, accuracy: 100 },
            "Earth Power": { type: "Ground", basePower: 90, accuracy: 100 },
            "Brave Bird": { type: "Flying", basePower: 120, accuracy: 100 },
        };

        // Physical moves array for damage calculation
        const physicalMoves = new Set([
            "Aqua Tail", "Thrash", "Crunch", "Ice Fang", "Drill Peck", "Earthquake",
            "Rock Slide", "Flare Blitz", "Cross Chop", "Darkest Lariat", "First Impression",
            "Liquidation", "Sucker Punch", "Brick Break", "Headlong Rush", "Wood Hammer",
            "Zen Headbutt", "Close Combat", "Thunder Punch", "U-turn", "Meteor Mash", "Extreme Speed",
            "Head Smash", "Giga Impact", "Dragon Claw", "Outrage", "Foul Play", "Crabhammer",
            "Poison Jab", "Sky Attack", "Superpower", "Wing Attack", "High Jump Kick", "Bounce",
            "Power Whip", "X-Scissor", "Megahorn", "High Horsepower", "Cross Poison", "Fire Fang",
            "Fly", "Double-Edge", "Iron Head", "Steel Wing", "Quick Attack", "Drill Run", "Last Resort",
            "Dragon Rush", "Phantom Force", "Astonish", "Strength", "Ice Punch", "Fire Punch", "Leaf Blade",
            "Throat Chop", "Focus Punch", "Knock Off", "Bullet Punch", "Ice Spinner", "Night Slash",
            "Play Rough", "Thunder Fang", "Icicle Crash", "Poltergeist", "Anchor Shot", "Dig",
            "Triple Arrows", "Hammer Arm", "Triple Axel", "Sacred Sword", "Psycho Cut", 
            "Wild Charge", "Petal Blizzard","Wave Crash", "Lunge", "Gigaton Hammer",
            "Ice Hammer", "Skitter Smack", "Gunk Shot", "Spin Out",
        ]);


        const pokemonMoves = {
            "Florges": ["Petal Dance", "Moonblast", "Pollen Puff", "Chilling Water"],
            "Togekiss": ["Air Slash", "Dazzling Gleam", "Aura Sphere", "Ancient Power"],
            "Gyarados": ["Aqua Tail", "Thrash", "Crunch", "Ice Fang"],
            "Milotic": ["Hydro Pump", "Ice Beam", "Dragon Pulse", "Disarming Voice"],
            "Noivern": ["Hurricane", "Boomburst", "Dragon Pulse", "Flamethrower"],
            "Charizard": ["Flamethrower", "Air Slash", "Dragon Pulse", "Ancient Power"],
            "Empoleon": ["Hydro Pump", "Flash Cannon", "Ice Beam", "Drill Peck"],
            "Mamoswine": ["Earthquake", "Thrash", "Ice Fang", "Rock Slide"],
            "Greninja": ["Hydro Pump", "Ice Beam", "Dark Pulse", "Extrasensory"],
            "Incineroar": ["Flare Blitz", "Thrash", "Cross Chop", "Darkest Lariat"],
            "Golisopod": ["First Impression", "Liquidation", "Sucker Punch", "Brick Break"],
            "Jolteon": ["Thunder", "Hyper Voice", "Shadow Ball", "Alluring Voice"],
            "Torterra": ["Headlong Rush", "Wood Hammer", "Crunch", "Zen Headbutt"],
            "Infernape": ["Flare Blitz", "Close Combat", "Thunder Punch", "U-turn"],
            "Lucario": ["Close Combat", "Meteor Mash", "Dragon Pulse", "Extreme Speed"],
            "Tyrantrum": ["Head Smash", "Giga Impact", "Dragon Claw", "Crunch"],
            "Chandelure": ["Overheat", "Shadow Ball", "Energy Ball", "Flamethrower"],
            "Krookodile": ["Earthquake", "Outrage", "Thrash", "Foul Play"],
            "Roserade": ["Petal Dance", "Sludge Bomb", "Dazzling Gleam", "Shadow Ball"],
            "Cryogonal": ["Ice Beam", "Solar Beam", "Flash Cannon", "Ancient Power"],
            "Gliscor": ["Earthquake", "Crabhammer", "Poison Jab", "Ice Fang"],
            "Braviary": ["Sky Attack", "Thrash", "Superpower", "Wing Attack"],
            "Mienshao": ["High Jump Kick", "U-turn", "Bounce", "Poison Jab"],
            "Tsareena": ["Power Whip", "High Jump Kick", "U-turn", "Zen Headbutt"],
            "Excadrill": ["Earthquake", "Iron Head", "Rock Slide", "X-Scissor"],
            "Rapidash": ["Flare Blitz", "Megahorn", "High Horsepower", "Poison Jab"],
            "Gengar": ["Shadow Ball", "Sludge Bomb", "Dream Eater", "Icy Wind"],
            "Drapion": ["Crunch", "Cross Poison", "Fire Fang", "Ice Fang"],
            "Clawitzer": ["Muddy Water", "Aura Sphere", "Dragon Pulse", "Dark Pulse"],
            "Vikavolt": ["Thunderbolt", "Bug Buzz", "Zap Cannon", "Fly"],
            "Mudsdale": ["Earthquake", "Double-Edge", "Superpower", "Iron Head"],
            "Talonflame": ["Brave Bird", "Flare Blitz", "Steel Wing", "Quick Attack"],
            "Escavalier": ["Giga Impact", "Iron Head", "X-Scissor", "Drill Run"],
            "Mismagius": ["Shadow Ball", "Power Gem", "Mystical Fire", "Magical Leaf"],
            "Dragalge": ["Outrage", "Sludge Bomb", "Hydro Pump", "Dragon Pulse"],
            "Dragapult": ["Last Resort", "Dragon Rush", "Phantom Force", "U-turn"],
            "Staraptor": ["Brave Bird", "Close Combat", "Double-Edge", "Astonish"],
            "Lopunny": ["High Jump Kick", "Strength", "Ice Punch", "Fire Punch"],
            "Whimsicott": ["Moonblast", "Solar Beam", "Hurricane", "Fairy Wind"],
            "Lilligant": ["Leaf Storm", "Pollen Puff", "Alluring Voice", "Tera Blast"],
            "Leavanny": ["Leaf Blade", "X-Scissor", "Throat Chop", "Poison Jab"],
            "Hariyama": ["Focus Punch", "Headlong Rush", "Knock Off", "Bullet Punch"],
            "Cinccino": ["Last Resort", "Ice Spinner", "Knock Off", "U-turn"],
            "Slowking": ["Future Sight", "Scald", "Belch", "Power Gem"],
            "Skarmory": ["Brave Bird", "Iron Head", "Night Slash", "Rock Slide"],
            "Stoutland": ["Giga Impact", "Crunch", "Play Rough", "Fire Fang"],
            "Houndoom": ["Flamethrower", "Foul Play", "Dark Pulse", "Thunder Fang"],
            "Beartic": ["Icicle Crash", "Superpower", "Thrash", "Night Slash"],
            "Zoroark": ["Dark Pulse", "Focus Blast", "Extrasensory", "Foul Play"],
            "Ampharos": ["Thunder", "Dazzling Gleam", "Dragon Pulse", "Power Gem"],
            "Dhelmise": ["Power Whip", "Poltergeist", "Anchor Shot", "Whirlpool"],
            "Leafeon": ["Leaf Blade", "Last Resort", "Dig", "X-Scissor"],
            "Primarina": ["Hydro Pump", "Moonblast", "Shadow Ball", "Icy Wind"],
            "Decidueye": ["Phantom Force", "Leaf Blade", "Triple Arrows", "Brave Bird"],
            "Swampert": ["Earthquake", "Hydro Pump", "Hammer Arm", "Rock Slide"],
            "Kingdra": ["Wave Crash", "Hydro Pump", "Dragon Pulse", "Ice Beam"],
            "Pheromosa": ["High Jump Kick", "Bug Buzz", "Poison Jab", "Triple Axel"],
            "Sceptile": ["Leaf Storm", "Dragon Pulse", "Focus Blast", "X-Scissor"],
            "Blaziken": ["Flare Blitz", "Close Combat", "Brave Bird", "Night Slash"],
            "Scizor": ["Iron Head", "X-Scissor", "Night Slash", "Wing Attack"],
            "Samurott": ["Hydro Pump", "Megahorn", "Sacred Sword", "Night Slash"],
            "Gardevoir": ["Future Sight", "Moonblast", "Mystical Fire", "Charge Beam"],
            "Gallade": ["Close Combat", "Psycho Cut", "Leaf Blade", "Night Slash"],
            "Aurorus": ["Hyper Beam", "Meteor Beam", "Blizzard", "Ice Beam"],
            "Suicune": ["Hydro Pump", "Blizzard", "Shadow Ball", "Extrasensory"],
            "Tapu Koko": ["Wild Charge", "Dazzling Gleam", "Brave Bird", "U-turn"],
            "Great Tusk": ["Headlong Rush", "Close Combat", "Megahorn", "Knock Off"],
            "Fezandipiti": ["Poison Jab", "Play Rough", "U-turn", "Brave Bird"],
            "Magnezone": ["Thunder", "Flash Cannon", "Tera Blast", "Thunderbolt"],
            "Durant": ["Iron Head", "X-Scissor", "Crunch", "Dig"],
            "Duraludon": ["Flash Cannon", "Dragon Claw", "Night Slash", "Solar Beam"],
            "Typhlosion": ["Eruption", "Shadow Ball", "Extrasensory", "Scorching Sands"],
            "Meowscarada": ["Foul Play", "Petal Blizzard", "Play Rough", "U-turn"],
            "Quaquaval": ["Wave Crash", "Close Combat", "Ice Spinner", "Wing Attack"],
            "Cinderace": ["Pyro Ball", "High Jump Kick", "Double-Edge", "Sucker Punch"],
            "Centiskorch": ["Burn Up", "Lunge", "Crunch", "Scorching Sands"],
            "Armarouge": ["Armor Cannon", "Psychic", "Energy Ball", "Focus Blast"],
            "Ceruledge": [ "Poltergeist", "Flare Blitz", "Close Combat", "Psycho Cut"],
            "Hatterene": ["Psychic", "Moonblast", "Mystical Fire", "Shadow Ball"],
            "Arboliva": ["Petal Dance", "Pollen Puff", "Earth Power", "Alluring Voice"],
            "Tinkaton": ["Play Rough", "Gigaton Hammer", "Ice Hammer", "Skitter Smack"],
            "Copperajah": ["Superpower", "Iron Head", "High Horsepower", "Play Rough"],
            "Revavroom": ["Gunk Shot", "Spin Out", "High Horsepower", "Zen Headbutt"],
            "Toxicroak": ["Close Combat", "Gunk Shot", "Sucker Punch", "X-Scissor"],
            "Kilowattrel": ["Thunder", "Hurricane", "Thunderbolt", "Uproar"],
            "Grafaiai": ["Gunk Shot", "Double-Edge", "U-turn", "Knock Off"],
            "Salamence": ["Outrage", "Fly", "Crunch", "Flamethrower"],
            "Nihilego": ["Power Gem", "Sludge Wave", "Thunderbolt", "Dazzling Gleam"],
            "Hydrapple": ["Energy Ball", "Dragon Pulse", "Hydro Pump", "Earth Power"],
            "Rillaboom": ["Wood Hammer", "Hammer Arm", "Knock Off", "U-turn"],
            "Inteleon": ["Hydro Pump", "Ice Beam", "Dark Pulse", "U-turn"],
            "Iron Valiant": ["Close Combat", "Moonblast", "Future Sight", "Night Slash"],
        };


        const pokemonTypes = {
            "Florges": ["Fairy"],
            "Togekiss": ["Fairy", "Flying"],
            "Gyarados": ["Water", "Flying"],
            "Milotic": ["Water"],
            "Noivern": ["Flying", "Dragon"],
            "Charizard": ["Fire", "Flying"],
            "Empoleon": ["Water", "Steel"],
            "Mamoswine": ["Ice", "Ground"],
            "Greninja": ["Water", "Dark"],
            "Incineroar": ["Fire", "Dark"],
            "Golisopod": ["Bug", "Water"],
            "Jolteon": ["Electric"],
            "Torterra": ["Grass", "Ground"],
            "Infernape": ["Fire", "Fighting"],
            "Lucario": ["Fighting", "Steel"],
            "Tyrantrum": ["Rock", "Dragon"],
            "Chandelure": ["Ghost", "Fire"],
            "Krookodile": ["Ground", "Dark"],
            "Roserade": ["Grass", "Poison"],
            "Cryogonal": ["Ice"],
            "Gliscor": ["Ground", "Flying"],
            "Braviary": ["Normal", "Flying"],
            "Mienshao": ["Fighting"],
            "Tsareena": ["Grass"],
            "Excadrill": ["Ground", "Steel"],
            "Rapidash": ["Fire"],
            "Gengar": ["Ghost", "Poison"],
            "Drapion": ["Poison", "Dark"],
            "Clawitzer": ["Water"],
            "Vikavolt": ["Bug", "Electric"],
            "Mudsdale": ["Ground"],
            "Talonflame": ["Fire", "Flying"],
            "Escavalier": ["Bug", "Steel"],
            "Mismagius": ["Ghost"],
            "Dragalge": ["Dragon", "Poison"],
            "Dragapult": ["Dragon", "Ghost"],
            "Staraptor": ["Normal", "Flying"],
            "Lopunny": ["Normal"],
            "Whimsicott": ["Fairy", "Grass"],
            "Lilligant": ["Grass"],
            "Leavanny": ["Bug", "Grass"],
            "Hariyama": ["Fighting"],
            "Cinccino": ["Normal"],
            "Slowking": ["Water", "Psychic"],
            "Skarmory": ["Steel", "Flying"],
            "Stoutland": ["Normal"],
            "Houndoom": ["Dark", "Fire"],
            "Beartic": ["Ice"],
            "Zoroark": ["Dark"],
            "Ampharos": ["Electric"],
            "Dhelmise": ["Ghost", "Grass"],
            "Leafeon": ["Grass"],
            "Primarina": ["Water", "Fairy"],
            "Decidueye": ["Grass", "Ghost"],
            "Swampert": ["Water", "Ground"],
            "Kingdra": ["Water", "Dragon"],
            "Pheromosa": ["Bug", "Fighting"],
            "Sceptile": ["Grass"],
            "Blaziken": ["Fire", "Fighting"],
            "Scizor": ["Bug", "Steel"],
            "Samurott": ["Water"],
            "Gardevoir": ["Psychic", "Fairy"],
            "Gallade": ["Psychic", "Fighting"],
            "Aurorus": ["Rock", "Ice"],
            "Suicune": ["Water"],
            "Tapu Koko": ["Electric", "Fairy"],
            "Great Tusk": ["Ground", "Fighting"],
            "Fezandipiti": ["Poison", "Fairy"],
            "Magnezone": ["Electric", "Steel"],
            "Durant": ["Bug", "Steel"],
            "Duraludon": ["Steel", "Dragon"],
            "Typhlosion": ["Fire"],
            "Meowscarada": ["Grass", "Dark"],
            "Quaquaval": ["Water", "Fighting"],
            "Cinderace": ["Fire"],
            "Centiskorch": ["Fire", "Bug"],
            "Armarouge": ["Fire", "Psychic"],
            "Ceruledge": ["Fire", "Ghost"],
            "Hatterene": ["Psychic", "Fairy"],
            "Arboliva": ["Grass", "Normal"],
            "Tinkaton": ["Fairy", "Steel"],
            "Copperajah": ["Steel"],
            "Revavroom": ["Steel", "Poison"],
            "Toxicroak": ["Poison", "Fighting"],
            "Kilowattrel": ["Electric", "Flying"],
            "Grafaiai": ["Poison", "Normal"],
            "Salamence": ["Dragon", "Flying"],
            "Nihilego": ["Rock", "Poison"],
            "Hydrapple": ["Grass", "Dragon"],
            "Rillaboom": ["Grass"],
            "Inteleon": ["Water"],
            "Iron Valiant": ["Fighting", "Psychic"],
        };

        const typeChart = {
            "Normal": { "Rock": 0.5, "Ghost": 0, "Steel": 0.5 },
            "Fire": { "Fire": 0.5, "Water": 0.5, "Grass": 2, "Ice": 2, "Bug": 2, "Rock": 0.5, "Dragon": 0.5, "Steel": 2 },
            "Water": { "Fire": 2, "Water": 0.5, "Grass": 0.5, "Ground": 2, "Rock": 2, "Dragon": 0.5 },
            "Electric": { "Water": 2, "Electric": 0.5, "Grass": 0.5, "Ground": 0, "Flying": 2, "Dragon": 0.5 },
            "Grass": { "Fire": 0.5, "Water": 2, "Grass": 0.5, "Poison": 0.5, "Ground": 2, "Flying": 0.5, "Bug": 0.5, "Rock": 2, "Dragon": 0.5, "Steel": 0.5 },
            "Ice": { "Fire": 0.5, "Water": 0.5, "Grass": 2, "Ice": 0.5, "Ground": 2, "Flying": 2, "Dragon": 2, "Steel": 0.5 },
            "Fighting": { "Normal": 2, "Ice": 2, "Rock": 2, "Dark": 2, "Steel": 2, "Poison": 0.5, "Flying": 0.5, "Psychic": 0.5, "Bug": 0.5, "Fairy": 0.5, "Ghost": 0 },
            "Poison": { "Grass": 2, "Poison": 0.5, "Ground": 0.5, "Rock": 0.5, "Ghost": 0.5, "Steel": 0, "Fairy": 2 },
            "Ground": { "Fire": 2, "Electric": 2, "Grass": 0.5, "Poison": 2, "Flying": 0, "Bug": 0.5, "Rock": 2, "Steel": 2 },
            "Flying": { "Electric": 0.5, "Grass": 2, "Fighting": 2, "Bug": 2, "Rock": 0.5, "Steel": 0.5 },
            "Psychic": { "Fighting": 2, "Poison": 2, "Psychic": 0.5, "Dark": 0, "Steel": 0.5 },
            "Bug": { "Fire": 0.5, "Grass": 2, "Fighting": 0.5, "Poison": 0.5, "Flying": 0.5, "Psychic": 2, "Ghost": 0.5, "Dark": 2, "Steel": 0.5, "Fairy": 0.5 },
            "Rock": { "Fire": 2, "Ice": 2, "Fighting": 0.5, "Ground": 0.5, "Flying": 2, "Bug": 2, "Steel": 0.5 },
            "Ghost": { "Normal": 0, "Psychic": 2, "Ghost": 2, "Dark": 0.5 },
            "Dragon": { "Dragon": 2, "Steel": 0.5, "Fairy": 0 },
            "Dark": { "Fighting": 0.5, "Psychic": 2, "Ghost": 2, "Dark": 0.5, "Fairy": 0.5 },
            "Steel": { "Fire": 0.5, "Water": 0.5, "Electric": 0.5, "Ice": 2, "Rock": 2, "Steel": 0.5, "Fairy": 2 },
            "Fairy": { "Fire": 0.5, "Fighting": 2, "Poison": 0.5, "Dragon": 2, "Dark": 2, "Steel": 0.5 }
        };

        const pokemonImages = {
            "Florges": "https://img.pokemondb.net/artwork/avif/florges.avif",
            "Togekiss": "https://img.pokemondb.net/artwork/avif/togekiss.avif",
            "Gyarados": "https://img.pokemondb.net/artwork/avif/gyarados.avif",
            "Milotic": "https://img.pokemondb.net/artwork/avif/milotic.avif",
            "Noivern": "https://img.pokemondb.net/artwork/avif/noivern.avif",
            "Charizard": "https://img.pokemondb.net/artwork/avif/charizard.avif",
            "Empoleon": "https://img.pokemondb.net/artwork/avif/empoleon.avif",
            "Mamoswine": "https://img.pokemondb.net/artwork/avif/mamoswine.avif",
            "Greninja": "https://img.pokemondb.net/artwork/avif/greninja.avif",
            "Incineroar": "https://img.pokemondb.net/artwork/avif/incineroar.avif",
            "Golisopod": "https://img.pokemondb.net/artwork/avif/golisopod.avif",
            "Jolteon": "https://img.pokemondb.net/artwork/avif/jolteon.avif",
            "Torterra": "https://img.pokemondb.net/artwork/avif/torterra.avif",
            "Infernape": "https://img.pokemondb.net/artwork/avif/infernape.avif",
            "Lucario": "https://img.pokemondb.net/artwork/avif/lucario.avif",
            "Tyrantrum": "https://img.pokemondb.net/artwork/avif/tyrantrum.avif",
            "Chandelure": "https://img.pokemondb.net/artwork/avif/chandelure.avif",
            "Krookodile": "https://img.pokemondb.net/artwork/avif/krookodile.avif",
            "Roserade": "https://img.pokemondb.net/artwork/avif/roserade.avif",
            "Cryogonal": "https://img.pokemondb.net/artwork/avif/cryogonal.avif",
            "Gliscor": "https://img.pokemondb.net/artwork/avif/gliscor.avif",
            "Braviary": "https://img.pokemondb.net/artwork/avif/braviary.avif",
            "Mienshao": "https://img.pokemondb.net/artwork/avif/mienshao.avif",
            "Tsareena": "https://img.pokemondb.net/artwork/avif/tsareena.avif",
            "Excadrill": "https://img.pokemondb.net/artwork/avif/excadrill.avif",
            "Rapidash": "https://img.pokemondb.net/artwork/avif/rapidash.avif",
            "Gengar": "https://img.pokemondb.net/artwork/avif/gengar.avif",
            "Drapion": "https://img.pokemondb.net/artwork/avif/drapion.avif",
            "Clawitzer": "https://img.pokemondb.net/artwork/avif/clawitzer.avif",
            "Vikavolt": "https://img.pokemondb.net/artwork/avif/vikavolt.avif",
            "Mudsdale": "https://img.pokemondb.net/artwork/avif/mudsdale.avif",
            "Talonflame": "https://img.pokemondb.net/artwork/avif/talonflame.avif",
            "Escavalier": "https://img.pokemondb.net/artwork/avif/escavalier.avif",
            "Mismagius": "https://img.pokemondb.net/artwork/avif/mismagius.avif",
            "Dragalge": "https://img.pokemondb.net/artwork/avif/dragalge.avif",
            "Dragapult": "https://img.pokemondb.net/artwork/avif/dragapult.avif",
            "Staraptor": "https://img.pokemondb.net/artwork/avif/staraptor.avif",
            "Lopunny": "https://img.pokemondb.net/artwork/avif/lopunny.avif",
            "Whimsicott": "https://img.pokemondb.net/artwork/avif/whimsicott.avif",
            "Lilligant": "https://img.pokemondb.net/artwork/avif/lilligant.avif",
            "Leavanny": "https://img.pokemondb.net/artwork/avif/leavanny.avif",
            "Hariyama": "https://img.pokemondb.net/artwork/avif/hariyama.avif",
            "Cinccino": "https://img.pokemondb.net/artwork/avif/cinccino.avif",
            "Slowking": "https://img.pokemondb.net/artwork/avif/slowking.avif",
            "Skarmory": "https://img.pokemondb.net/artwork/avif/skarmory.avif",
            "Stoutland": "https://img.pokemondb.net/artwork/avif/stoutland.avif",
            "Houndoom": "https://img.pokemondb.net/artwork/avif/houndoom.avif",
            "Beartic": "https://img.pokemondb.net/artwork/avif/beartic.avif",
            "Zoroark": "https://img.pokemondb.net/artwork/avif/zoroark.avif",
            "Ampharos": "https://img.pokemondb.net/artwork/avif/ampharos.avif",
            "Dhelmise": "https://img.pokemondb.net/artwork/avif/dhelmise.avif",
            "Leafeon": "https://img.pokemondb.net/artwork/avif/leafeon.avif",
            "Primarina": "https://img.pokemondb.net/artwork/avif/primarina.avif",
            "Decidueye": "https://img.pokemondb.net/artwork/avif/decidueye.avif",
            "Swampert": "https://img.pokemondb.net/artwork/avif/swampert.avif",
            "Kingdra": "https://img.pokemondb.net/artwork/avif/kingdra.avif",
            "Pheromosa": "https://img.pokemondb.net/artwork/avif/pheromosa.avif",
            "Sceptile": "https://img.pokemondb.net/artwork/avif/sceptile.avif",
            "Blaziken": "https://img.pokemondb.net/artwork/avif/blaziken.avif",
            "Scizor": "https://img.pokemondb.net/artwork/avif/scizor.avif",
            "Samurott": "https://img.pokemondb.net/artwork/avif/samurott.avif",
            "Gardevoir": "https://img.pokemondb.net/artwork/avif/gardevoir.avif",
            "Gallade": "https://img.pokemondb.net/artwork/avif/gallade.avif",
            "Aurorus": "https://img.pokemondb.net/artwork/avif/aurorus.avif",
            "Suicune": "https://img.pokemondb.net/artwork/avif/suicune.avif",
            "Tapu Koko": "https://img.pokemondb.net/artwork/avif/tapu-koko.avif",
            "Great Tusk": "https://img.pokemondb.net/artwork/avif/great-tusk.avif",
            "Fezandipiti": "https://img.pokemondb.net/artwork/avif/fezandipiti.avif",
            "Magnezone": "https://img.pokemondb.net/artwork/avif/magnezone.avif",
            "Durant": "https://img.pokemondb.net/artwork/avif/durant.avif",
            "Duraludon": "https://img.pokemondb.net/artwork/avif/duraludon.avif",
            "Typhlosion": "https://img.pokemondb.net/artwork/avif/typhlosion.avif",
            "Meowscarada": "https://img.pokemondb.net/artwork/avif/meowscarada.avif",
            "Quaquaval": "https://img.pokemondb.net/artwork/avif/quaquaval.avif",
            "Cinderace": "https://img.pokemondb.net/artwork/avif/cinderace.avif",
            "Centiskorch": "https://img.pokemondb.net/artwork/avif/centiskorch.avif",
            "Armarouge": "https://img.pokemondb.net/artwork/avif/armarouge.avif",
            "Ceruledge": "https://img.pokemondb.net/artwork/avif/ceruledge.avif",
            "Hatterene": "https://img.pokemondb.net/artwork/avif/hatterene.avif",
            "Arboliva": "https://img.pokemondb.net/artwork/avif/arboliva.avif",
            "Tinkaton": "https://img.pokemondb.net/artwork/avif/tinkaton.avif",
            "Copperajah": "https://img.pokemondb.net/artwork/avif/copperajah.avif",
            "Revavroom": "https://img.pokemondb.net/artwork/avif/revavroom.avif",
            "Toxicroak": "https://img.pokemondb.net/artwork/avif/toxicroak.avif",
            "Kilowattrel": "https://img.pokemondb.net/artwork/avif/kilowattrel.avif",
            "Grafaiai": "https://img.pokemondb.net/artwork/avif/grafaiai.avif",
            "Salamence": "https://img.pokemondb.net/artwork/avif/salamence.avif",
            "Nihilego": "https://img.pokemondb.net/artwork/avif/nihilego.avif",
            "Hydrapple": "https://sg.portal-pokemon.com/play/resources/pokedex/img/pm/393ca6d6fc72b016e991c0437f9651f9f20ec2ce.png",
            "Rillaboom": "https://img.pokemondb.net/artwork/avif/rillaboom.avif",
            "Inteleon": "https://img.pokemondb.net/artwork/avif/inteleon.avif",
            "Iron Valiant": "https://img.pokemondb.net/artwork/avif/iron-valiant.avif",
        };

    // Game state
    let playerX = 25, playerY = 25;
    let collectedPokemon = [];        let currentTeam = [];
        let playerMoney = 100; // Starting money
        let collectedCards = []; // Array to track collected cards
        let trainersDefeated = 0; // Track number of trainers defeated
        
        // Card definitions
        const tradingCards = [
          {
            id: 'tulip',
            name: 'Tulip',
            trainersRequired: 1,
            image: 'https://efour.b-cdn.net/uploads/default/original/3X/7/7/77a9a230ebf4b29bd12a91262a4756bd750f1c26.jpeg',
            description: 'Card #1 - Defeat 1 trainer to collect'
          },
          {
            id: 'sabrina',
            name: 'Sabrina', 
            trainersRequired: 2,
            image: 'https://efour.b-cdn.net/uploads/default/original/3X/4/b/4b3b3dca103545f603c0e3d14517129ad0e16dfc.jpeg',
            description: 'Card #2 - Defeat 2 trainers to collect'
          },
          {
            id: 'rosa',
            name: 'Rosa',
            trainersRequired: 3,
            image: 'https://efour.b-cdn.net/uploads/default/original/3X/1/9/198103ac1aa2ddcac8aa3a5fb464854f3ab2b14a.jpeg', 
            description: 'Card #3 - Defeat 3 trainers to collect'
          },
          {
            id: 'oleanna',
            name: 'Oleanna',
            trainersRequired: 4,
            image: 'https://efour.b-cdn.net/uploads/default/original/3X/f/8/f8a1b1f62b4be6231987e46b86cd8d4bce30c053.jpeg',
            description: 'Card #4 - Defeat 4 trainers to collect'
          },
          {
            id: 'sonia',
            name: 'Sonia',
            trainersRequired: 5,
            image: 'https://efour.b-cdn.net/uploads/default/original/3X/f/a/fa2caf2fdbebbe83928535bd7c08ee57846390b3.jpeg',
            description: 'Card #5 - Defeat 5 trainers to collect'
          },
          {
            id: 'nessa',
            name: 'Nessa',
            trainersRequired: 6,
            image: 'https://efour.b-cdn.net/uploads/default/original/3X/0/0/00d94ca450ef65aacafd6809719870208c88047d.jpeg',
            description: 'Card #6 - Defeat 6 trainers to collect'
          },
          {
            id: 'skyla',
            name: 'Skyla',
            trainersRequired: 7,
            image: 'https://efour.b-cdn.net/uploads/default/original/3X/d/8/d8321e22b92874e17ffbb757b5513e58cb13b332.jpeg',
            description: 'Card #7 - Defeat 7 trainers to collect'
          },
          {
            id: 'klara',
            name: 'Klara',
            trainersRequired: 8,
            image: 'https://efour.b-cdn.net/uploads/default/original/3X/7/2/7208b84bc8f78fb5618bf5520bc03748f02f8d3a.jpeg',
            description: 'Card #8 - Defeat 8 trainers to collect'
          }
        ];
    let money = 0;
    let trainers = [];
    let inBattle = false;
    let stepCounter = 0;

    // Audio system variables
    let youtubePlayer = null;
    let isPlayerReady = false;
    let isMusicPlaying = false;
    
    // Default YouTube video ID (FarmLifeGaming soundtrack)
    const defaultMusicVideoId = 'tzb2nGOwXpI'; // You can change this to any YouTube video ID

    // Map generation
    const mapSize = 50;
    let gameMap = [];

    function initGame() {
      generateMap();
      updateDisplay();
      setupControls();
      
      // Spawn initial trainers after team is ready
      setTimeout(() => {
        if (currentTeam.length >= 6) {
          spawnTrainers();
        }
      }, 1000);
    }

    function generateMap() {
      const mapGrid = document.getElementById('map-grid');
      mapGrid.innerHTML = '';
      
      for (let y = 0; y < mapSize; y++) {
        gameMap[y] = [];
        for (let x = 0; x < mapSize; x++) {
          const tile = document.createElement('div');
          tile.className = 'tile';
          tile.id = `tile-${x}-${y}`;
          
          // Generate terrain - 60% grass, 20% trees, 15% paths, 5% water
          let terrain = 'grass';
          const rand = Math.random();
          if (rand < 0.05) terrain = 'water';
          else if (rand < 0.2) terrain = 'path';
          else if (rand < 0.4) terrain = 'tree';
          
          tile.classList.add(terrain);
          gameMap[y][x] = terrain;
          
          // Player starting position
          if (x === playerX && y === playerY) {
            tile.classList.add('player');
          }
          
          mapGrid.appendChild(tile);
        }
      }
    }

    function movePlayer(dx, dy) {
      if (inBattle) return;
      
      const newX = playerX + dx;
      const newY = playerY + dy;
      
      // Check boundaries
      if (newX < 0 || newX >= mapSize || newY < 0 || newY >= mapSize) return;
      
      // Check if tile is passable (can't walk on water)
      if (gameMap[newY][newX] === 'water') return;
      
      // Remove player from old position
      const oldTile = document.getElementById(`tile-${playerX}-${playerY}`);
      oldTile.classList.remove('player');
      
      // Move player
      playerX = newX;
      playerY = newY;
      
      // Add player to new position
      const newTile = document.getElementById(`tile-${playerX}-${playerY}`);
      newTile.classList.add('player');
      
      // Increment step counter
      stepCounter++;
      
      updateDisplay();
      
      // Check for Pokemon encounter on grass
      if (gameMap[playerY][playerX] === 'grass' && Math.random() < 0.33) {
        findPokemon();
      }
      
      // Check for trainer battle
      checkTrainerEncounter();
      
      // Spawn new trainer every 25 steps if player has 6+ Pokemon
      if (collectedPokemon.length >= 6 && stepCounter % 25 === 0) {
        spawnRandomTrainer();
      }
    }

    function findPokemon() {
      const allPokemon = Object.keys(pokemonStats);
      const uncaughtPokemon = allPokemon.filter(name => !collectedPokemon.includes(name));
      
      if (uncaughtPokemon.length === 0) {
        updateStatus("You've caught all Pokemon!");
        return;
      }
      
      const foundPokemon = uncaughtPokemon[Math.floor(Math.random() * uncaughtPokemon.length)];
      collectedPokemon.push(foundPokemon);
      
      updateStatus(`Found ${foundPokemon}!`);
      
      // Auto-add to team if less than 6
      if (currentTeam.length < 6) {
        currentTeam.push({
          name: foundPokemon,
          hp: pokemonStats[foundPokemon][0],
          maxHp: pokemonStats[foundPokemon][0],
          fainted: false
        });
        updateStatus(`${foundPokemon} added to your team!`);
        
        // Show auto-select button if team is full
        if (currentTeam.length === 6) {
          document.getElementById('auto-team-btn').style.display = 'none';
          spawnTrainers();
        }
      }
      
      updateDisplay();
    }

    function spawnTrainers() {
      if (currentTeam.length < 6) return;
      
      // Spawn 3 trainers randomly on the map
      for (let i = 0; i < 3; i++) {
        let x, y;
        do {
          x = Math.floor(Math.random() * mapSize);
          y = Math.floor(Math.random() * mapSize);
        } while (
          gameMap[y][x] === 'water' || 
          (x === playerX && y === playerY) ||
          trainers.some(t => t.x === x && t.y === y)
        );
        
        trainers.push({ x, y, defeated: false });
        
        const tile = document.getElementById(`tile-${x}-${y}`);
        tile.classList.add('trainer');
      }
      
      updateStatus("Trainers have appeared! Walk up to them and press Enter to battle!");
    }

    function spawnRandomTrainer() {
      // Find a valid spawn location
      let x, y;
      let attempts = 0;
      do {
        x = Math.floor(Math.random() * mapSize);
        y = Math.floor(Math.random() * mapSize);
        attempts++;
        if (attempts > 100) return; // Prevent infinite loop if map is full
      } while (
        gameMap[y][x] === 'water' || 
        (x === playerX && y === playerY) ||
        trainers.some(t => t.x === x && t.y === y && !t.defeated)
      );
      
      trainers.push({ x, y, defeated: false });
      
      const tile = document.getElementById(`tile-${x}-${y}`);
      tile.classList.add('trainer');
      
      updateStatus(`A new trainer has appeared after ${stepCounter} steps!`);
    }

    function checkTrainerEncounter() {
      const trainer = trainers.find(t => t.x === playerX && t.y === playerY && !t.defeated);
      if (trainer) {
        startTrainerBattle(trainer);
      }
    }

    function startTrainerBattle(trainer) {
      inBattle = true;
      
      // Generate AI team
      const allPokemon = Object.keys(pokemonStats);
      const aiTeam = [];
      for (let i = 0; i < 6; i++) {
        const randomPokemon = allPokemon[Math.floor(Math.random() * allPokemon.length)];
        aiTeam.push({
          name: randomPokemon,
          hp: pokemonStats[randomPokemon][0],
          maxHp: pokemonStats[randomPokemon][0],
          fainted: false
        });
      }
      
      // Reset player team HP
      currentTeam.forEach(pokemon => {
        pokemon.hp = pokemon.maxHp;
        pokemon.fainted = false;
      });
      
      openBattleModal(trainer, aiTeam);
    }

    function openBattleModal(trainer, aiTeam) {
      const modal = document.getElementById('battle-modal');
      const content = document.getElementById('battle-content');
      
      content.innerHTML = `
        <div class="battle-info">
          <div class="battle-pokemon">
            <h3>Your Team</h3>
            <div id="player-team-status"></div>
          </div>
          <div class="battle-pokemon">
            <h3>Trainer's Team</h3>
            <div id="ai-team-status"></div>
          </div>
        </div>
        
        <div class="battle-log" id="battle-log"></div>
        
        <div id="battle-phase">
          <h3>Select your Pokemon for battle:</h3>
          <div class="battle-selection" id="pokemon-selection"></div>
          <button class="button" onclick="confirmSelection()" id="confirm-btn" disabled>Confirm Selection</button>
          <button class="button danger" onclick="closeBattle()">Flee Battle</button>
        </div>
      `;
      
      modal.style.display = 'flex';
      
      // Start battle system
      startBattleSystem(trainer, aiTeam);
    }

    let battleState = {
      trainer: null,
      aiTeam: [],
      playerSelection: null,
      aiSelection: null,
      round: 1,
      selectedMove: null,
      currentPlayerPokemon: null,
      currentAiPokemon: null,
      awaitingPlayerMove: false
    };

    function startBattleSystem(trainer, aiTeam) {
      battleState.trainer = trainer;
      battleState.aiTeam = aiTeam;
      battleState.round = 1;
      
      updateBattleDisplay();
      showPokemonSelection();
      logBattle("Trainer wants to battle!");
      logBattle("Choose your Pokemon for round 1!");
    }

    function showPokemonSelection() {
      const selection = document.getElementById('pokemon-selection');
      selection.innerHTML = '';
      
      currentTeam.forEach((pokemon, index) => {
        if (!pokemon.fainted) {
          const card = document.createElement('div');
          card.className = 'battle-pokemon-card';
          card.onclick = () => selectPokemon(index);
          card.innerHTML = `
            <strong>${pokemon.name}</strong><br>
            <small>HP: ${pokemon.hp}/${pokemon.maxHp}</small>
            <div class="hp-bar">
              <div class="hp-fill" style="width: ${(pokemon.hp/pokemon.maxHp)*100}%"></div>
            </div>
          `;
          selection.appendChild(card);
        }
      });
    }

    function selectPokemon(index) {
      battleState.playerSelection = index;
      
      // Update selection display
      document.querySelectorAll('.battle-pokemon-card').forEach(card => {
        card.classList.remove('selected');
      });
      
      const cards = document.querySelectorAll('.battle-pokemon-card');
      if (cards[index]) {
        cards[index].classList.add('selected');
      }
      
      document.getElementById('confirm-btn').disabled = false;
    }

    function confirmSelection() {
      if (battleState.playerSelection === null) return;
      
      // AI selects random living Pokemon
      const alivePokemon = battleState.aiTeam.filter(p => !p.fainted);
      if (alivePokemon.length === 0) {
        endBattle(true);
        return;
      }
      
      const aiChoice = battleState.aiTeam.findIndex(p => !p.fainted && p === alivePokemon[Math.floor(Math.random() * alivePokemon.length)]);
      battleState.aiSelection = aiChoice;
      
      // Start individual battle
      startIndividualBattle();
    }

    function startIndividualBattle() {
      const playerPokemon = currentTeam[battleState.playerSelection];
      const aiPokemon = battleState.aiTeam[battleState.aiSelection];
      
      logBattle(`Round ${battleState.round}: ${playerPokemon.name} vs ${aiPokemon.name}!`);
      
      // Set current Pokemon for 1v1 battle
      battleState.currentPlayerPokemon = playerPokemon;
      battleState.currentAiPokemon = aiPokemon;
      
      // Show current battle info
      showCurrentBattleInfo();
      
      // Start the 1v1 battle with move selection
      start1v1Battle(playerPokemon, aiPokemon);
    }

    function showCurrentBattleInfo() {
      const battlePhase = document.getElementById('battle-phase');
      battlePhase.innerHTML = `
        <div class="battle-pokemon-info">
          <div class="current-battle-pokemon">
            <img src="${pokemonImages[battleState.currentPlayerPokemon.name]}" alt="${battleState.currentPlayerPokemon.name}" 
                 style="width: 120px; height: 120px; object-fit: contain; border-radius: 8px; margin-bottom: 10px;">
            <h3>${battleState.currentPlayerPokemon.name}</h3>
            <div>HP: ${battleState.currentPlayerPokemon.hp}/${battleState.currentPlayerPokemon.maxHp}</div>
            <div class="hp-bar">
              <div class="hp-fill" style="width: ${(battleState.currentPlayerPokemon.hp/battleState.currentPlayerPokemon.maxHp)*100}%"></div>
            </div>
          </div>
          <div style="display: flex; align-items: center; font-size: 24px; font-weight: bold;">VS</div>
          <div class="current-battle-pokemon">
            <img src="${pokemonImages[battleState.currentAiPokemon.name]}" alt="${battleState.currentAiPokemon.name}" 
                 style="width: 120px; height: 120px; object-fit: contain; border-radius: 8px; margin-bottom: 10px;">
            <h3>${battleState.currentAiPokemon.name}</h3>
            <div>HP: ${battleState.currentAiPokemon.hp}/${battleState.currentAiPokemon.maxHp}</div>
            <div class="hp-bar">
              <div class="hp-fill" style="width: ${(battleState.currentAiPokemon.hp/battleState.currentAiPokemon.maxHp)*100}%"></div>
            </div>
          </div>
        </div>
        <div id="move-selection-area"></div>
        <button class="button danger" onclick="closeBattle()">Flee Battle</button>
      `;
    }

    function start1v1Battle(playerPokemon, aiPokemon) {
      if (playerPokemon.hp <= 0 || aiPokemon.hp <= 0) {
        end1v1Battle();
        return;
      }
      
      // Show move selection for player
      showMoveSelection(playerPokemon, aiPokemon);
    }

    function showMoveSelection(playerPokemon, aiPokemon) {
      const moveArea = document.getElementById('move-selection-area');
      
      const playerMoves = pokemonMoves[playerPokemon.name] || ['Tackle'];
      
      moveArea.innerHTML = `
        <h3>Choose ${playerPokemon.name}'s move:</h3>
        <div class="move-selection" id="move-selection">
          ${playerMoves.map((moveName, index) => {
            const move = moves[moveName];
            if (!move) return ''; // Skip invalid moves
            
            const effectiveness = calculateTypeEffectiveness(move.type, pokemonTypes[aiPokemon.name]);
            const effText = getEffectivenessText(effectiveness);
            
            return `
              <div class="move-button" onclick="selectMove('${moveName}', ${index})">
                <div class="move-name">${moveName}</div>
                <div class="move-details">
                  ${move.type} | ${move.basePower} BP | ${move.accuracy}% Acc
                  <br><span class="effectiveness ${effText.class}">${effText.text}</span>
                </div>
              </div>
            `;
          }).join('')}
        </div>
        <button class="button" onclick="executeTurn()" id="execute-move-btn" disabled>Use Move</button>
      `;
      
      battleState.selectedMove = null;
      battleState.awaitingPlayerMove = true;
    }

    function calculateTypeEffectiveness(moveType, defenderTypes) {
      let effectiveness = 1;
      for (const defenderType of defenderTypes) {
        const typeMatchup = typeChart[moveType]?.[defenderType];
        if (typeMatchup !== undefined) {
          effectiveness *= typeMatchup;
        }
        // If any type matchup results in 0 (immunity), the total effectiveness is 0
        if (effectiveness === 0) {
          break;
        }
      }
      return effectiveness;
    }

    function getEffectivenessText(effectiveness) {
      if (effectiveness === 0) return { text: "No Effect", class: "no-effect" };
      if (effectiveness > 1) return { text: "Super Effective!", class: "super-effective" };
      if (effectiveness < 1) return { text: "Not Very Effective", class: "not-very-effective" };
      return { text: "", class: "" };
    }

    function selectMove(moveName, index) {
      console.log(`Selecting move: ${moveName} at index ${index}`);
      battleState.selectedMove = moveName;
      
      // Update UI selection
      document.querySelectorAll('.move-button').forEach(btn => btn.classList.remove('selected'));
      const buttons = document.querySelectorAll('.move-button');
      if (buttons[index]) {
        buttons[index].classList.add('selected');
        console.log(`Move button ${index} selected successfully`);
      } else {
        console.log(`Error: Move button ${index} not found`);
      }
      
      const executeBtn = document.getElementById('execute-move-btn');
      if (executeBtn) {
        executeBtn.disabled = false;
        console.log(`Execute button enabled`);
      } else {
        console.log(`Error: Execute button not found`);
      }
      
      logBattle(`Selected move: ${moveName}`);
    }

    function executeTurn() {
      console.log(`ExecuteTurn called - selectedMove: ${battleState.selectedMove}, awaitingPlayerMove: ${battleState.awaitingPlayerMove}`);
      
      if (!battleState.selectedMove || !battleState.awaitingPlayerMove) {
        console.log(`ExecuteTurn blocked - missing move or not awaiting`);
        logBattle(`Error: Cannot execute turn - selectedMove: ${battleState.selectedMove}, awaitingPlayerMove: ${battleState.awaitingPlayerMove}`);
        return;
      }
      
      const playerPokemon = battleState.currentPlayerPokemon;
      const aiPokemon = battleState.currentAiPokemon;
      
      console.log(`Player Pokemon: ${playerPokemon?.name}, AI Pokemon: ${aiPokemon?.name}`);
      
      battleState.awaitingPlayerMove = false;
      
      // AI selects best move using pokebattler logic
      const aiMove = selectBestAIMove(aiPokemon.name, playerPokemon.name);
      
      // Determine speed order
      const playerSpeed = pokemonStats[playerPokemon.name][5];
      const aiSpeed = pokemonStats[aiPokemon.name][5];
      const playerFirst = playerSpeed > aiSpeed || (playerSpeed === aiSpeed && Math.random() < 0.5);
      
      logBattle(`Speed check: ${playerPokemon.name} (${playerSpeed}) vs ${aiPokemon.name} (${aiSpeed}) - ${playerFirst ? 'Player' : 'AI'} goes first!`);
      
      // Execute the turn
      executeBattleTurn(playerPokemon, aiPokemon, battleState.selectedMove, aiMove, playerFirst);
    }

    function selectBestAIMove(attackerName, defenderName) {
      const availableMoves = pokemonMoves[attackerName] || ['Tackle'];
      let bestMove = availableMoves[0];
      let bestScore = 0;
      
      availableMoves.forEach(moveName => {
        const move = moves[moveName];
        if (!move) return;
        
        const stab = pokemonTypes[attackerName].includes(move.type) ? 1.5 : 1;
        const eff = pokemonTypes[defenderName].reduce((m, t) => m * (typeChart[move.type]?.[t] || 1), 1);
        
        // Calculate expected damage score (base power * STAB * effectiveness * accuracy)
        const score = move.basePower * stab * eff * (move.accuracy / 100);
        
        if (score > bestScore) {
          bestScore = score;
          bestMove = moveName;
        }
      });
      
      return bestMove;
    }

    function executeBattleTurn(playerPokemon, aiPokemon, playerMove, aiMove, playerFirst) {
      // Hide move selection during attack execution
      document.getElementById('move-selection-area').innerHTML = '<div style="padding: 20px; text-align: center;">Executing moves...</div>';
      
      logBattle(`AI selected move: ${aiMove}`);
      logBattle(`Player selected move: ${playerMove}`);
      
      if (playerFirst) {
        // Player attacks first
        logBattle(`${playerPokemon.name} attacks first!`);
        aiPokemon.hp = doAttack(playerPokemon.name, aiPokemon.name, aiPokemon.hp, playerMove);
        showCurrentBattleInfo();
        updateBattleDisplay();
        
        if (aiPokemon.hp <= 0) {
          aiPokemon.fainted = true;
          logBattle(`${aiPokemon.name} fainted!`);
          // Heal player Pokemon to full HP for scoring a KO
          playerPokemon.hp = playerPokemon.maxHp;
          logBattle(`${playerPokemon.name} restored to full health for scoring a KO!`);
          setTimeout(() => end1v1Battle(), 1500);
          return;
        }
        
        // AI counter-attacks
        setTimeout(() => {
          logBattle(`${aiPokemon.name} counter-attacks!`);
          playerPokemon.hp = doAttack(aiPokemon.name, playerPokemon.name, playerPokemon.hp, aiMove);
          showCurrentBattleInfo();
          updateBattleDisplay();
          
          if (playerPokemon.hp <= 0) {
            playerPokemon.fainted = true;
            logBattle(`${playerPokemon.name} fainted!`);
            // Heal AI Pokemon to full HP for scoring a KO
            aiPokemon.hp = aiPokemon.maxHp;
            logBattle(`${aiPokemon.name} restored to full health for scoring a KO!`);
            setTimeout(() => end1v1Battle(), 1500);
          } else {
            // Continue battle - show move selection again
            setTimeout(() => start1v1Battle(playerPokemon, aiPokemon), 1000);
          }
        }, 1000);
        
      } else {
        // AI attacks first
        logBattle(`${aiPokemon.name} attacks first!`);
        playerPokemon.hp = doAttack(aiPokemon.name, playerPokemon.name, playerPokemon.hp, aiMove);
        showCurrentBattleInfo();
        updateBattleDisplay();
        
        if (playerPokemon.hp <= 0) {
          playerPokemon.fainted = true;
          logBattle(`${playerPokemon.name} fainted!`);
          // Heal AI Pokemon to full HP for scoring a KO
          aiPokemon.hp = aiPokemon.maxHp;
          logBattle(`${aiPokemon.name} restored to full health for scoring a KO!`);
          setTimeout(() => end1v1Battle(), 1500);
          return;
        }
        
        // Player counter-attacks
        setTimeout(() => {
          logBattle(`${playerPokemon.name} counter-attacks!`);
          aiPokemon.hp = doAttack(playerPokemon.name, aiPokemon.name, aiPokemon.hp, playerMove);
          showCurrentBattleInfo();
          updateBattleDisplay();
          
          if (aiPokemon.hp <= 0) {
            aiPokemon.fainted = true;
            logBattle(`${aiPokemon.name} fainted!`);
            // Heal player Pokemon to full HP for scoring a KO
            playerPokemon.hp = playerPokemon.maxHp;
            logBattle(`${playerPokemon.name} restored to full health for scoring a KO!`);
            setTimeout(() => end1v1Battle(), 1500);
          } else {
            // Continue battle - show move selection again
            setTimeout(() => start1v1Battle(playerPokemon, aiPokemon), 1000);
          }
        }, 1000);
      }
    }

    // Use pokebattler's exact doAttack function
    function doAttack(attacker, defender, defHP, forcedMove) {
      const moveName = forcedMove || pokemonMoves[attacker][Math.floor(Math.random() * pokemonMoves[attacker].length)];
      const mv = moves[moveName];
      
      if (!mv) {
        logBattle(`${attacker} tried to use ${moveName} but the move failed!`);
        return defHP;
      }

      // Special handling for Triple Axel
      if (moveName === "Triple Axel") {
        return handleTripleAxel(attacker, defender, defHP, mv);
      }

      if (Math.random() * 100 > mv.accuracy) { 
        logBattle(`${attacker}'s ${moveName} missed!`);
        return defHP; 
      }

      const isPhysical = physicalMoves.has(moveName);
      const atk = isPhysical ? pokemonStats[attacker][1] : pokemonStats[attacker][3];
      const def = isPhysical ? pokemonStats[defender][2] : pokemonStats[defender][4];

      const stab = pokemonTypes[attacker].includes(mv.type) ? 1.5 : 1;
      const eff = calculateTypeEffectiveness(mv.type, pokemonTypes[defender]);
      const rand = Math.random() * 0.15 + 0.85;
      let dmg = Math.floor(((((2 * 100 / 5 + 2) * mv.basePower * (atk / def)) / 50) + 2) * stab * eff * rand);
      
      if (eff > 0 && dmg < 1) dmg = 1; 
      if (eff === 0) dmg = 0;

      defHP -= dmg;
      
      let effectivenessMessage = "";
      if (eff > 1) effectivenessMessage = " It's super effective!";
      else if (eff < 1 && eff > 0) effectivenessMessage = " It's not very effective...";
      else if (eff === 0) effectivenessMessage = " It has no effect!";
      
      logBattle(`${attacker} used ${moveName}! It dealt ${dmg} damage.${effectivenessMessage}`);
      return Math.max(0, defHP);
    }

    function handleTripleAxel(attacker, defender, defHP, mv) {
      logBattle(`${attacker} used Triple Axel!`);
      
      const isPhysical = physicalMoves.has("Triple Axel");
      const atk = isPhysical ? pokemonStats[attacker][1] : pokemonStats[attacker][3];
      const def = isPhysical ? pokemonStats[defender][2] : pokemonStats[defender][4];
      
      const stab = pokemonTypes[attacker].includes(mv.type) ? 1.5 : 1;
      const eff = calculateTypeEffectiveness(mv.type, pokemonTypes[defender]);
      
      if (eff === 0) {
        logBattle("It has no effect!");
        return defHP;
      }
      
      let totalDamage = 0;
      let hitCount = 0;
      const basePowers = [20, 60, 120]; // Power for each hit
      
      for (let hit = 1; hit <= 3; hit++) {
        // Calculate accuracy for this hit: 0.9^hit
        const hitAccuracy = Math.pow(0.9, hit) * 100;
        
        if (Math.random() * 100 <= hitAccuracy) {
          hitCount++;
          const rand = Math.random() * 0.15 + 0.85;
          let dmg = Math.floor(((((2 * 100 / 5 + 2) * basePowers[hit - 1] * (atk / def)) / 50) + 2) * stab * eff * rand);
          
          if (eff > 0 && dmg < 1) dmg = 1;
          
          totalDamage += dmg;
          logBattle(`Hit ${hit}! Dealt ${dmg} damage.`);
        } else {
          logBattle(`Hit ${hit} missed!`);
          break; // If a hit misses, subsequent hits don't occur
        }
      }
      
      if (hitCount > 0) {
        let effectivenessMessage = "";
        if (eff > 1) effectivenessMessage = " It's super effective!";
        else if (eff < 1 && eff > 0) effectivenessMessage = " It's not very effective...";
        
        logBattle(`Triple Axel hit ${hitCount} time(s) for ${totalDamage} total damage!${effectivenessMessage}`);
        defHP -= totalDamage;
      } else {
        logBattle("Triple Axel missed completely!");
      }
      
      return Math.max(0, defHP);
    }

    function end1v1Battle() {
      // Check if overall battle should continue
      setTimeout(() => checkBattleEnd(), 1000);
    }

    function checkBattleEnd() {
      const playerAlive = currentTeam.some(p => !p.fainted);
      const aiAlive = battleState.aiTeam.some(p => !p.fainted);
      
      if (!playerAlive) {
        endBattle(false);
      } else if (!aiAlive) {
        endBattle(true);
      } else {
        // Continue to next round
        battleState.round++;
        battleState.playerSelection = null;
        battleState.aiSelection = null;
        battleState.selectedMove = null;
        battleState.currentPlayerPokemon = null;
        battleState.currentAiPokemon = null;
        battleState.awaitingPlayerMove = false;
        
        updateBattleDisplay();
        
        setTimeout(() => {
          const battlePhase = document.getElementById('battle-phase');
          battlePhase.innerHTML = `
            <h3>Round ${battleState.round}! Choose your next Pokemon:</h3>
            <div class="battle-selection" id="pokemon-selection"></div>
            <button class="button" onclick="confirmSelection()" id="confirm-btn" disabled>Confirm Selection</button>
            <button class="button danger" onclick="closeBattle()">Flee Battle</button>
          `;
          showPokemonSelection();
          logBattle(`Round ${battleState.round}! Choose your next Pokemon!`);
        }, 2000);
      }
    }

    function endBattle(playerWon) {
      if (playerWon) {
        playerMoney += 100;
        trainersDefeated++;
        logBattle(`You won! Gained $100! (Trainers defeated: ${trainersDefeated})`);
        battleState.trainer.defeated = true;
        
        // Check for new cards
        checkForNewCards();
        
        // Remove trainer from map
        const tile = document.getElementById(`tile-${battleState.trainer.x}-${battleState.trainer.y}`);
        tile.classList.remove('trainer');
      } else {
        logBattle("You lost the battle!");
      }
      
      setTimeout(() => {
        closeBattle();
      }, 3000);
    }

    function closeBattle() {
      document.getElementById('battle-modal').style.display = 'none';
      inBattle = false;
      updateDisplay();
    }

    function updateBattleDisplay() {
      const playerStatus = document.getElementById('player-team-status');
      const aiStatus = document.getElementById('ai-team-status');
      
      if (playerStatus) {
        playerStatus.innerHTML = currentTeam.map(p => `
          <div style="margin: 5px 0; padding: 5px; background: ${p.fainted ? '#666' : '#444'}; border-radius: 3px;">
            ${p.name}: ${p.fainted ? 'Fainted' : `${p.hp}/${p.maxHp} HP`}
          </div>
        `).join('');
      }
      
      if (aiStatus) {
        aiStatus.innerHTML = battleState.aiTeam.map(p => `
          <div style="margin: 5px 0; padding: 5px; background: ${p.fainted ? '#666' : '#444'}; border-radius: 3px;">
            ${p.name}: ${p.fainted ? 'Fainted' : `${p.hp}/${p.maxHp} HP`}
          </div>
        `).join('');
      }
    }

    function logBattle(message) {
      const log = document.getElementById('battle-log');
      if (log) {
        log.innerHTML += `<div style="margin: 2px 0;">${message}</div>`;
        log.scrollTop = log.scrollHeight;
      }
    }

    function updateDisplay() {
      document.getElementById('collection-count').textContent = collectedPokemon.length;
      document.getElementById('money').textContent = playerMoney;
      document.getElementById('player-x').textContent = playerX;
      document.getElementById('player-y').textContent = playerY;
      document.getElementById('step-count').textContent = stepCounter;
      
      // Update team display
      const teamDisplay = document.getElementById('team-display');
      if (currentTeam.length === 0) {
        teamDisplay.textContent = 'No Pokemon in team';
      } else {
        // Create a 3x2 grid for up to 6 team members
        const teamSlots = [];
        for (let i = 0; i < 6; i++) {
          const pokemon = currentTeam[i];
          if (pokemon) {
            const hpPercentage = (pokemon.hp / pokemon.maxHp) * 100;
            let hpBarClass = 'high';
            if (hpPercentage <= 25) hpBarClass = 'low';
            else if (hpPercentage <= 50) hpBarClass = 'medium';
            
            const pokemonImage = pokemonImages[pokemon.name] || 'https://via.placeholder.com/50x50?text=?';
            
            teamSlots.push(`
              <div class="team-pokemon">
                <div class="team-pokemon-image" style="background-image: url('${pokemonImage}')"></div>
                <div class="team-pokemon-name">${pokemon.name}</div>
                <div class="hp-bar-container">
                  <div class="hp-bar ${hpBarClass}" style="width: ${hpPercentage}%"></div>
                </div>
                <div class="hp-text">${pokemon.hp}/${pokemon.maxHp}</div>
              </div>
            `);
          } else {
            // Empty slot
            teamSlots.push(`
              <div class="team-pokemon" style="opacity: 0.3;">
                <div class="team-pokemon-image" style="background: #333;"></div>
                <div class="team-pokemon-name">Empty</div>
                <div class="hp-bar-container">
                  <div class="hp-bar" style="width: 0%"></div>
                </div>
                <div class="hp-text">-/-</div>
              </div>
            `);
          }
        }
        
        teamDisplay.innerHTML = `<div class="team-grid">${teamSlots.join('')}</div>`;
      }
      
      // Show auto-select team button if needed
      if (collectedPokemon.length >= 6 && currentTeam.length < 6) {
        document.getElementById('auto-team-btn').style.display = 'inline-block';
      }
    }

    function updateStatus(message) {
      document.getElementById('game-status').textContent = message;
      setTimeout(() => {
        document.getElementById('game-status').textContent = 'Walk on grass to find Pokemon!';
      }, 3000);
    }

    function autoSelectTeam() {
      currentTeam = [];
      for (let i = 0; i < Math.min(6, collectedPokemon.length); i++) {
        const pokemonName = collectedPokemon[i];
        currentTeam.push({
          name: pokemonName,
          hp: pokemonStats[pokemonName][0],
          maxHp: pokemonStats[pokemonName][0],
          fainted: false
        });
      }
      
      document.getElementById('auto-team-btn').style.display = 'none';
      updateDisplay();
      updateStatus("Team auto-selected!");
      
      if (currentTeam.length === 6) {
        spawnTrainers();
      }
    }

    function openBag() {
      const modal = document.getElementById('bag-modal');
      const cardsContainer = document.getElementById('pokemon-cards');
      
      // Reset to pokemon tab
      document.querySelectorAll('#bag-modal .shop-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector('#bag-modal .shop-tab').classList.add('active');
      document.getElementById('pokemon-collection').style.display = 'block';
      document.getElementById('card-binder').style.display = 'none';
      
      cardsContainer.innerHTML = '';
      
      collectedPokemon.forEach(pokemonName => {
        const card = createPokemonCard(pokemonName);
        cardsContainer.appendChild(card);
      });
      
      modal.style.display = 'flex';
    }

    function closeBag() {
      document.getElementById('bag-modal').style.display = 'none';
    }

    function createPokemonCard(pokemonName) {
      const stats = pokemonStats[pokemonName];
      const types = pokemonTypes[pokemonName] || ['Normal'];
      const pokemonMovesData = pokemonMoves[pokemonName] || ['Tackle', 'Quick Attack', 'Growl', 'Leer'];
      
      const card = document.createElement('div');
      card.className = 'pokemon-card';
      
      card.innerHTML = `
        <div class="card-header">
          <div class="pokemon-name">${pokemonName}</div>
          <div class="pokemon-types">
            ${types.map(type => `<span class="type-badge type-${type.toLowerCase()}">${type}</span>`).join('')}
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="stat">
            <div class="stat-label">HP</div>
            <div class="stat-value">${stats[0]}</div>
          </div>
          <div class="stat">
            <div class="stat-label">Attack</div>
            <div class="stat-value">${stats[1]}</div>
          </div>
          <div class="stat">
            <div class="stat-label">Defense</div>
            <div class="stat-value">${stats[2]}</div>
          </div>
          <div class="stat">
            <div class="stat-label">Sp. Atk</div>
            <div class="stat-value">${stats[3]}</div>
          </div>
          <div class="stat">
            <div class="stat-label">Sp. Def</div>
            <div class="stat-value">${stats[4]}</div>
          </div>
          <div class="stat">
            <div class="stat-label">Speed</div>
            <div class="stat-value">${stats[5]}</div>
          </div>
        </div>
        
        <div class="moves-section">
          <strong>Moves:</strong>
          <div class="moves-grid">
            ${pokemonMovesData.map(move => `<div class="move">${move}</div>`).join('')}
          </div>
        </div>
        
        <div style="margin-top: 15px; text-align: center;">
          <button class="button danger" onclick="removePokemon('${pokemonName}')" style="padding: 8px 12px; font-size: 12px;">
            Remove from Bag
          </button>
        </div>
      `;
      
      return card;
    }

    function removePokemon(pokemonName) {
      // Check if Pokemon is currently in the active team
      const inTeam = currentTeam.some(pokemon => pokemon.name === pokemonName);
      
      if (inTeam) {
        // If Pokemon is in team, check if we have enough total Pokemon to replace it
        if (collectedPokemon.length <= 6) {
          alert(`Cannot remove ${pokemonName} - you need at least 7 total Pokemon to remove team members! (Currently have ${collectedPokemon.length})`);
          return;
        }
        
        // Additional confirmation for team members
        if (!confirm(`${pokemonName} is in your active team! A replacement will be automatically added. Are you sure you want to remove it?`)) {
          return;
        }
      }
      
      // Confirm removal
      if (confirm(`Are you sure you want to remove ${pokemonName} from your collection? This cannot be undone.`)) {
        // Remove from collected Pokemon
        const index = collectedPokemon.indexOf(pokemonName);
        if (index > -1) {
          collectedPokemon.splice(index, 1);
          
          // If Pokemon was in team, remove it and add a replacement
          if (inTeam) {
            const teamIndex = currentTeam.findIndex(pokemon => pokemon.name === pokemonName);
            if (teamIndex > -1) {
              currentTeam.splice(teamIndex, 1);
              
              // Find a replacement Pokemon (one not currently in team)
              const availablePokemon = collectedPokemon.filter(name => 
                !currentTeam.some(teamMember => teamMember.name === name)
              );
              
              if (availablePokemon.length > 0) {
                const replacementName = availablePokemon[0];
                currentTeam.push({
                  name: replacementName,
                  hp: pokemonStats[replacementName][0],
                  maxHp: pokemonStats[replacementName][0],
                  fainted: false
                });
                updateStatus(`${pokemonName} removed! ${replacementName} added to team as replacement.`);
              }
            }
          } else {
            updateStatus(`${pokemonName} removed from collection!`);
          }
          
          // Update displays
          updateDisplay();
          
          // Refresh the bag view
          openBag();
        }
      }
    }

    // Card System Functions
    function checkForNewCards() {
      const newCards = tradingCards.filter(card => 
        trainersDefeated >= card.trainersRequired && 
        !collectedCards.includes(card.id)
      );
      
      newCards.forEach(card => {
        collectedCards.push(card.id);
        updateStatus(`ðŸŽ‰ New card unlocked: ${card.name}! ðŸŽ‰`);
        
        // Check for victory
        if (collectedCards.length === tradingCards.length) {
          setTimeout(() => {
            alert('ðŸŽ‰ CONGRATULATIONS! You\'ve collected all 8 trading cards and beat the game! ðŸŽ‰');
          }, 1000);
        }
      });
    }

    function showBagTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('#bag-modal .shop-tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      // Show/hide sections
      document.getElementById('pokemon-collection').style.display = tabName === 'pokemon' ? 'block' : 'none';
      document.getElementById('card-binder').style.display = tabName === 'cards' ? 'block' : 'none';
      
      if (tabName === 'cards') {
        populateCardBinder();
      }
    }

    function populateCardBinder() {
      const cardDisplay = document.getElementById('trading-cards-display');
      cardDisplay.innerHTML = '';
      
      tradingCards.forEach(card => {
        const isCollected = collectedCards.includes(card.id);
        const canCollect = trainersDefeated >= card.trainersRequired;
        
        const cardElement = document.createElement('div');
        cardElement.className = `trading-card ${isCollected ? 'collected' : (canCollect ? '' : 'locked')}`;
        cardElement.innerHTML = `
          <div class="card-image" style="background-image: url('${card.image}')"></div>
          <div class="card-info">
            <div class="card-name">${card.name}</div>
            <div class="card-status">
              ${isCollected ? 'âœ“ COLLECTED' : 
                canCollect ? 'ðŸ”“ AVAILABLE' : 
                `ðŸ”’ Defeat ${card.trainersRequired} trainers`}
            </div>
          </div>
        `;
        cardDisplay.appendChild(cardElement);
      });
      
      // Check if all cards are collected
      if (collectedCards.length === tradingCards.length) {
        document.getElementById('card-victory-message').style.display = 'block';
      }
    }

    // Shop Functions
    function openShop() {
      const modal = document.getElementById('shop-modal');
      updateMoneyDisplay();
      populatePokemonShop();
      modal.style.display = 'flex';
    }

    function closeShop() {
      document.getElementById('shop-modal').style.display = 'none';
    }

    function showShopTab(tabName) {
      // Only pokemon tab now, so this function is simplified
      document.getElementById('pokemon-shop').style.display = 'block';
    }

    function updateMoneyDisplay() {
      document.getElementById('money-display').textContent = playerMoney;
      document.getElementById('money').textContent = playerMoney;
    }

    function populatePokemonShop() {
      const shopList = document.getElementById('pokemon-shop-list');
      shopList.innerHTML = '';
      
      // Get all pokemon names from pokemonStats
      const allPokemon = Object.keys(pokemonStats);
      
      allPokemon.forEach(pokemonName => {
        const types = pokemonTypes[pokemonName] || ['Normal'];
        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="padding: 8px; border: 1px solid #ccc;">${pokemonName}</td>
          <td style="padding: 8px; border: 1px solid #ccc;">
            ${types.map(type => `<span class="type-badge type-${type.toLowerCase()}" style="font-size: 12px; padding: 2px 6px;">${type}</span>`).join(' ')}
          </td>
          <td style="padding: 8px; border: 1px solid #ccc;">
            <button class="button" onclick="buyPokemon('${pokemonName}')" ${playerMoney < 100 ? 'disabled' : ''}>
              Buy ($100)
            </button>
          </td>
        `;
        shopList.appendChild(row);
      });
    }

    function buyPokemon(pokemonName) {
      if (playerMoney >= 100) {
        playerMoney -= 100;
        
        if (!collectedPokemon.includes(pokemonName)) {
          collectedPokemon.push(pokemonName);
        }
        
        updateMoneyDisplay();
        updateDisplay();
        updateStatus(`${pokemonName} purchased for $100!`);
        
        // Refresh the shop
        populatePokemonShop();
      }
    }

    function setupControls() {
      document.addEventListener('keydown', (e) => {
        if (inBattle) {
          if (e.key === 'Enter') {
            const confirmBtn = document.getElementById('confirm-btn');
            if (confirmBtn && !confirmBtn.disabled) {
              confirmSelection();
            }
          }
          return;
        }
        
        switch(e.key.toLowerCase()) {
          case 'w':
          case 'arrowup':
            e.preventDefault();
            movePlayer(0, -1);
            break;
          case 's':
          case 'arrowdown':
            e.preventDefault();
            movePlayer(0, 1);
            break;
          case 'a':
          case 'arrowleft':
            e.preventDefault();
            movePlayer(-1, 0);
            break;
          case 'd':
          case 'arrowright':
            e.preventDefault();
            movePlayer(1, 0);
            break;
          case 'enter':
            e.preventDefault();
            checkTrainerEncounter();
            break;
        }
      });
    }

    // YouTube Audio System Functions
    function onYouTubeIframeAPIReady() {
      youtubePlayer = new YT.Player('youtube-player', {
        height: '1',
        width: '1',
        videoId: defaultMusicVideoId,
        playerVars: {
          'autoplay': 0,
          'controls': 0,
          'loop': 1,
          'playlist': defaultMusicVideoId
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady(event) {
      isPlayerReady = true;
      youtubePlayer.setVolume(30); // Default volume
      console.log('YouTube player ready');
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        isMusicPlaying = true;
        updatePlayButton();
      } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
        isMusicPlaying = false;
        updatePlayButton();
      }
    }

    function toggleMusic() {
      if (!isPlayerReady) {
        console.log('Player not ready yet');
        return;
      }

      if (isMusicPlaying) {
        youtubePlayer.pauseVideo();
      } else {
        youtubePlayer.playVideo();
      }
    }

    function stopMusic() {
      if (!isPlayerReady) return;
      youtubePlayer.stopVideo();
      isMusicPlaying = false;
      updatePlayButton();
    }

    function setVolume(volume) {
      if (!isPlayerReady) return;
      youtubePlayer.setVolume(volume);
    }

    function updatePlayButton() {
      const button = document.getElementById('play-pause-btn');
      if (isMusicPlaying) {
        button.textContent = 'ðŸ”‡ Pause';
        button.classList.add('paused');
      } else {
        button.textContent = 'ðŸ”Š Play';
        button.classList.remove('paused');
      }
    }

    // Initialize game when page loads
    window.onload = initGame;
  </script>
  
  <!-- Audio Controls -->
  <div class="audio-controls" id="audio-controls">
    <div>
      <button class="audio-button" id="play-pause-btn" onclick="toggleMusic()">ðŸ”Š Play</button>
      <button class="audio-button" id="stop-btn" onclick="stopMusic()">â¹ï¸ Stop</button>
    </div>
    <div class="volume-control">
      <span style="color: white; font-size: 12px;">Vol:</span>
      <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="30" onchange="setVolume(this.value)">
    </div>
  </div>

  <!-- Hidden YouTube Player -->
  <div id="youtube-player"></div>

  <!-- YouTube API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // ...existing code...

    // Initialize game when page loads
    window.onload = initGame;
  </script>
</body>
</html>
